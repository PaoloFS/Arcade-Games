<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Arcade Zone - Multiplayer Games</title>
	<style>
@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Orbitron:wght@400;700;900&display=swap');

/* ============================================
   MODERN CSS ARCHITECTURE 2025
   - CSS Cascade Layers para organizaci√≥n
   - Container Queries para responsividad
   - Custom Properties con fallbacks
   - Animaciones GPU-optimizadas
   - Logical Properties para i18n
============================================ */

@layer reset, tokens, base, components, utilities, animations;

/* ============================================
   LAYER: RESET
============================================ */
@layer reset {
  *, *::before, *::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  :where(img, picture, video, canvas, svg) {
    display: block;
    max-inline-size: 100%;
  }

  :where(input, button, textarea, select) {
    font: inherit;
  }
}

/* ============================================
   LAYER: DESIGN TOKENS
============================================ */
@layer tokens {
  :root {
    /* Colors - Neon Palette */
    --clr-neon-cyan: oklch(90% 0.25 195);
    --clr-neon-pink: oklch(65% 0.28 350);
    --clr-neon-yellow: oklch(85% 0.22 90);
    --clr-neon-purple: oklch(60% 0.25 285);
    --clr-neon-green: oklch(80% 0.30 145);
    
    /* Backgrounds */
    --clr-bg-dark: oklch(15% 0.05 255);
    --clr-bg-darker: oklch(10% 0.03 255);
    --clr-card-bg: oklch(18% 0.04 255 / 0.95);
    
    /* Fluid Spacing Scale */
    --space-3xs: clamp(0.25rem, 0.23rem + 0.11vw, 0.31rem);
    --space-2xs: clamp(0.5rem, 0.46rem + 0.22vw, 0.63rem);
    --space-xs: clamp(0.75rem, 0.68rem + 0.33vw, 0.94rem);
    --space-sm: clamp(1rem, 0.91rem + 0.43vw, 1.25rem);
    --space-md: clamp(1.5rem, 1.37rem + 0.65vw, 1.88rem);
    --space-lg: clamp(2rem, 1.83rem + 0.87vw, 2.5rem);
    --space-xl: clamp(3rem, 2.74rem + 1.3vw, 3.75rem);
    --space-2xl: clamp(4rem, 3.65rem + 1.74vw, 5rem);
    
    /* Fluid Typography Scale */
    --fs-xs: clamp(0.75rem, 0.71rem + 0.22vw, 0.88rem);
    --fs-sm: clamp(0.88rem, 0.83rem + 0.24vw, 1rem);
    --fs-base: clamp(1rem, 0.96rem + 0.22vw, 1.13rem);
    --fs-md: clamp(1.13rem, 1.08rem + 0.24vw, 1.27rem);
    --fs-lg: clamp(1.27rem, 1.19rem + 0.38vw, 1.5rem);
    --fs-xl: clamp(1.5rem, 1.37rem + 0.65vw, 1.88rem);
    --fs-2xl: clamp(1.88rem, 1.63rem + 1.2vw, 2.5rem);
    --fs-3xl: clamp(2.5rem, 2.07rem + 2.17vw, 3.75rem);
    
    /* Border Radius */
    --radius-sm: 0.5rem;
    --radius-md: 1rem;
    --radius-lg: 1.5rem;
    --radius-full: 9999px;
    
    /* Transitions */
    --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
    --transition-base: 250ms cubic-bezier(0.4, 0, 0.2, 1);
    --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);
    --transition-bounce: 500ms cubic-bezier(0.34, 1.56, 0.64, 1);
    
    /* Shadows */
    --shadow-glow-cyan: 0 0 20px color-mix(in oklch, var(--clr-neon-cyan), transparent 40%);
    --shadow-glow-pink: 0 0 20px color-mix(in oklch, var(--clr-neon-pink), transparent 40%);
    --shadow-glow-yellow: 0 0 20px color-mix(in oklch, var(--clr-neon-yellow), transparent 40%);
    
    /* Z-index Scale */
    --z-base: 1;
    --z-elevated: 10;
    --z-modal: 100;
    --z-alert: 1000;
  }

  @media (prefers-color-scheme: dark) {
    :root {
      color-scheme: dark;
    }
  }
}

/* ============================================
   LAYER: BASE STYLES
============================================ */
@layer base {
  html {
    color-scheme: dark;
    hanging-punctuation: first last;
  }

  body {
    min-block-size: 100vh;
    min-block-size: 100dvh;
    font-family: 'Orbitron', system-ui, sans-serif;
    color: white;
    background: 
      radial-gradient(ellipse at top, 
        oklch(25% 0.08 255) 0%, 
        oklch(15% 0.05 255) 50%, 
        oklch(5% 0.02 255) 100%);
    background-attachment: fixed;
    overflow-x: clip;
    position: relative;
    
    /* Performance optimizations */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
  }

  /* Animated Background - Optimized */
  .animated-bg {
    position: fixed;
    inset: 0;
    z-index: 0;
    overflow: hidden;
    pointer-events: none;
    contain: layout style paint;
  }

  /* Perspective Grid */
  .grid-lines {
    position: absolute;
    inset: 0;
    background-image: 
      linear-gradient(color-mix(in oklch, var(--clr-neon-cyan), transparent 70%) 1px, transparent 1px),
      linear-gradient(90deg, color-mix(in oklch, var(--clr-neon-cyan), transparent 70%) 1px, transparent 1px);
    background-size: 50px 50px;
    opacity: 0.3;
    transform: perspective(500px) rotateX(60deg);
    will-change: transform;
    animation: gridMove 25s linear infinite;
  }

  /* Floating Particles */
  .animated-bg::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image: 
      radial-gradient(circle, var(--clr-neon-cyan) 1px, transparent 1px),
      radial-gradient(circle, var(--clr-neon-pink) 1px, transparent 1px),
      radial-gradient(circle, var(--clr-neon-purple) 1px, transparent 1px);
    background-size: 300px 300px, 400px 400px, 350px 350px;
    background-position: 0 0, 100px 100px, 200px 50px;
    opacity: 0.15;
    will-change: background-position;
    animation: particleFloat 30s ease-in-out infinite;
  }

  /* Light Rays */
  .animated-bg::after {
    content: '';
    position: absolute;
    inset: -50%;
    background: 
      conic-gradient(from 0deg at 50% 50%, 
        transparent 0deg, 
        color-mix(in oklch, var(--clr-neon-cyan), transparent 95%) 45deg,
        transparent 90deg,
        color-mix(in oklch, var(--clr-neon-pink), transparent 95%) 135deg,
        transparent 180deg);
    will-change: transform;
    animation: lightRotate 40s linear infinite;
  }

  /* Starfield */
  .stars {
    position: absolute;
    inset: 0;
  }

  .star {
    position: absolute;
    inline-size: 2px;
    block-size: 2px;
    background: white;
    border-radius: var(--radius-full);
    box-shadow: 
      0 0 4px color-mix(in oklch, white, transparent 50%),
      0 0 8px color-mix(in oklch, var(--clr-neon-cyan), transparent 70%);
    will-change: opacity, transform;
    animation: twinkle 3s ease-in-out infinite;
  }

  /* Container */
  .container {
    position: relative;
    z-index: var(--z-base);
    max-inline-size: min(1400px, 96vw);
    margin-inline: auto;
    padding-block: var(--space-md);
    padding-inline: var(--space-sm);
  }
}

/* ============================================
   LAYER: COMPONENTS
============================================ */
@layer components {
  
  /* Header */
  .header {
    text-align: center;
    margin-block-end: var(--space-xl);
    padding-block: var(--space-md);
    container-type: inline-size;
  }

  .header h1 {
    font-family: 'Press Start 2P', cursive;
    font-size: var(--fs-2xl);
    line-height: 1.4;
    margin-block-end: var(--space-sm);
    
    background: linear-gradient(
      90deg,
      var(--clr-neon-cyan) 0%,
      var(--clr-neon-pink) 25%,
      var(--clr-neon-yellow) 50%,
      var(--clr-neon-purple) 75%,
      var(--clr-neon-cyan) 100%
    );
    background-size: 200% auto;
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    
    filter: drop-shadow(0 0 20px color-mix(in oklch, var(--clr-neon-cyan), transparent 30%));
    will-change: background-position;
    animation: gradientFlow 8s linear infinite;
  }

  .header p {
    font-size: var(--fs-base);
    color: var(--clr-neon-cyan);
    letter-spacing: 0.1em;
    text-shadow: 
      0 0 10px var(--clr-neon-cyan),
      0 0 20px color-mix(in oklch, var(--clr-neon-cyan), transparent 50%);
  }

  /* User Panel */
  .user-panel {
    position: relative;
    background: var(--clr-card-bg);
    border: 2px solid transparent;
    border-radius: var(--radius-lg);
    padding: var(--space-md);
    margin-block-end: var(--space-xl);
    backdrop-filter: blur(12px);
    
    display: flex;
    justify-content: center;
    align-items: center;
    flex-wrap: wrap;
    gap: var(--space-md);
    
    container-type: inline-size;
    contain: layout style paint;
    isolation: isolate;
  }

  .user-panel::before {
    content: '';
    position: absolute;
    inset: 0px;
    border-radius: inherit;
    background: linear-gradient(
      90deg,
      var(--clr-neon-cyan),
      var(--clr-neon-pink),
      var(--clr-neon-yellow),
      var(--clr-neon-cyan)
    );
    background-size: 200% 100%;
    z-index: -1;
    will-change: background-position;
    animation: borderFlow 6s linear infinite;
    mask: 
      linear-gradient(#fff 0 0) content-box, 
      linear-gradient(#fff 0 0);
    mask-composite: exclude;
    -webkit-mask: 
      linear-gradient(#fff 0 0) content-box, 
      linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    padding: 2px;
  }

  .user-info {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
  }

  .user-avatar {
    inline-size: clamp(50px, 10cqi, 70px);
    block-size: clamp(50px, 10cqi, 70px);
    background: linear-gradient(135deg, var(--clr-neon-pink), var(--clr-neon-purple));
    border-radius: var(--radius-full);
    border: 3px solid var(--clr-neon-cyan);
    
    display: grid;
    place-items: center;
    font-size: clamp(1.5rem, 5cqi, 2.5rem);
    
    box-shadow: 
      0 0 20px color-mix(in oklch, var(--clr-neon-pink), transparent 40%),
      inset 0 0 20px color-mix(in oklch, white, transparent 70%);
    
    flex-shrink: 0;
    contain: layout style paint;
  }

  .user-name {
    font-size: var(--fs-md);
    font-weight: 700;
    color: var(--clr-neon-yellow);
    text-shadow: 
      0 0 10px var(--clr-neon-yellow),
      0 0 20px color-mix(in oklch, var(--clr-neon-yellow), transparent 50%);
    word-break: break-word;
    max-inline-size: 30ch;
  }

  /* Input Group */
  .input-group {
    display: flex;
    gap: var(--space-sm);
    align-items: center;
    flex-wrap: wrap;
    justify-content: center;
  }

  .arcade-input {
    padding-block: 0.75rem;
    padding-inline: 1rem;
    background: oklch(10% 0.03 255 / 0.6);
    border: 2px solid var(--clr-neon-cyan);
    border-radius: var(--radius-sm);
    color: white;
    font-family: inherit;
    font-size: var(--fs-sm);
    min-inline-size: min(180px, 100%);
    
    transition: all var(--transition-base);
    box-shadow: 
      inset 0 0 15px color-mix(in oklch, var(--clr-neon-cyan), transparent 70%),
      0 0 10px color-mix(in oklch, var(--clr-neon-cyan), transparent 80%);
  }

  .arcade-input:focus {
    outline: none;
    border-color: var(--clr-neon-pink);
    background: oklch(10% 0.03 255 / 0.8);
    box-shadow: 
      0 0 20px color-mix(in oklch, var(--clr-neon-pink), transparent 50%),
      inset 0 0 20px color-mix(in oklch, var(--clr-neon-pink), transparent 70%);
  }

  .arcade-input::placeholder {
    color: color-mix(in oklch, white, transparent 50%);
  }

  /* Buttons */
  .arcade-btn {
    position: relative;
    padding-block: 0.75rem;
    padding-inline: 1.5rem;
    
    background: linear-gradient(135deg, var(--clr-neon-pink), var(--clr-neon-purple));
    border: 2px solid var(--clr-neon-cyan);
    border-radius: var(--radius-sm);
    color: white;
    
    font-family: inherit;
    font-weight: 700;
    font-size: var(--fs-sm);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    
    cursor: pointer;
    overflow: hidden;
    white-space: nowrap;
    
    transition: all var(--transition-base);
    box-shadow: 
      0 0 15px color-mix(in oklch, var(--clr-neon-pink), transparent 50%),
      0 4px 15px oklch(10% 0.03 255 / 0.5);
    
    contain: layout style paint;
    z-index: 1;
  }

	.arcade-btn::before {
	  content: '';
	  position: absolute;
	  top: 50%;
	  left: 50%;
	  inline-size: 0;
	  block-size: 0;
	  background: color-mix(in oklch, white, transparent 60%);
	  border-radius: var(--radius-full);
	  transform: translate(-50%, -50%);
	  transition: inline-size 800ms ease-out, block-size 800ms ease-out;
	  pointer-events: none;
	  z-index: 0;
	}

  .arcade-btn:hover {
    transform: translateY(-2px) scale(1.02);
    box-shadow: 
      0 8px 30px color-mix(in oklch, var(--clr-neon-pink), transparent 30%),
      0 0 30px color-mix(in oklch, var(--clr-neon-cyan), transparent 50%);
  }

  .arcade-btn:hover::before {
	  inline-size: 500px;
	  block-size: 500px;
	}

  .arcade-btn:active {
    transform: translateY(0) scale(0.98);
  }

  .arcade-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
  }

  .arcade-btn > * {
	  position: relative;
	  z-index: 2;
	}

  /* Game Cards */
  .games-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(min(300px, 100%), 1fr));
    gap: var(--space-lg);
    margin-block-end: var(--space-xl);
    container-type: inline-size;
  }

  .game-card {
    position: relative;
    background: var(--clr-card-bg);
    border: 2px solid transparent;
    border-radius: var(--radius-lg);
    padding: var(--space-lg);
    
    cursor: pointer;
    overflow: hidden;
    backdrop-filter: blur(12px);
    
    transition: all var(--transition-slow);
    box-shadow: 0 10px 30px oklch(5% 0.02 255 / 0.6);
    
    contain: layout style paint;
    content-visibility: auto;
    isolation: isolate;
  }

  .game-card::before {
    content: '';
    position: absolute;
    inset: 0px;
    border-radius: inherit;
    background: linear-gradient(
      135deg,
      var(--clr-neon-cyan),
      var(--clr-neon-pink),
      var(--clr-neon-purple)
    );
    background-size: 200% 200%;
    z-index: -1;
    opacity: 0.5;
    will-change: background-position, opacity;
    animation: borderGlow 8s ease-in-out infinite;
    mask: 
      linear-gradient(#fff 0 0) content-box, 
      linear-gradient(#fff 0 0);
    mask-composite: exclude;
    -webkit-mask: 
      linear-gradient(#fff 0 0) content-box, 
      linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    padding: 2px;
  }

  .game-card:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: 
      0 20px 50px color-mix(in oklch, var(--clr-neon-cyan), transparent 50%),
      0 0 40px color-mix(in oklch, var(--clr-neon-pink), transparent 60%);
  }

  .game-card:hover::before {
    opacity: 1;
  }

  .game-icon {
    font-size: clamp(3.5rem, 12cqi, 5rem);
    text-align: center;
    margin-block-end: var(--space-sm);
    filter: drop-shadow(0 0 15px currentColor);
  }

  .game-card:nth-child(1) .game-icon {
    color: var(--clr-neon-yellow);
  }

  .game-card:nth-child(2) .game-icon {
    color: var(--clr-neon-pink);
  }

  .game-title {
    font-family: 'Press Start 2P', cursive;
    font-size: var(--fs-md);
    text-align: center;
    margin-block-end: var(--space-sm);
    color: var(--clr-neon-cyan);
    line-height: 1.6;
    text-shadow: 
      0 0 10px var(--clr-neon-cyan),
      0 0 20px color-mix(in oklch, var(--clr-neon-cyan), transparent 60%);
    word-wrap: break-word;
  }

  .game-description {
    text-align: center;
    opacity: 0.9;
    margin-block-end: var(--space-md);
    font-size: var(--fs-sm);
    line-height: 1.6;
    color: color-mix(in oklch, white, transparent 15%);
  }

  .game-stats-preview {
    display: flex;
    justify-content: space-around;
    padding: var(--space-sm);
    background: oklch(10% 0.03 255 / 0.5);
    border-radius: var(--radius-md);
    margin-block-end: var(--space-sm);
    gap: var(--space-sm);
    border: 2px solid color-mix(in oklch, var(--clr-neon-cyan), transparent 70%);
    box-shadow: 
      inset 0 0 20px color-mix(in oklch, var(--clr-neon-cyan), transparent 90%),
      0 0 10px color-mix(in oklch, var(--clr-neon-cyan), transparent 80%);
  }

  .stat-preview {
    text-align: center;
    flex: 1;
  }

  .stat-preview-value {
    font-size: var(--fs-lg);
    font-weight: 700;
    color: var(--clr-neon-yellow);
    text-shadow: 
      0 0 10px var(--clr-neon-yellow),
      0 0 20px color-mix(in oklch, var(--clr-neon-yellow), transparent 50%);
  }

  .stat-preview-label {
    font-size: var(--fs-xs);
    opacity: 0.7;
    text-transform: uppercase;
    margin-block-start: 0.25rem;
  }

  /* Modal */
  .modal {
    display: none;
    position: fixed;
    inset: 0;
    background: oklch(5% 0.02 255 / 0.95);
    z-index: var(--z-modal);
    backdrop-filter: blur(10px);
  }

  .modal.active {
    display: grid;
    place-items: center;
    padding: var(--space-md);
    animation: fadeIn 300ms ease;
  }

	.modal-content {
	  position: relative;
	  background: linear-gradient(
	    135deg,
	    oklch(15% 0.04 255 / 0.98),
	    oklch(20% 0.05 255 / 0.98)
	  );
	  border: 2px solid transparent;
	  border-radius: var(--radius-lg);
	  padding: var(--space-md); /* REDUCIDO de var(--space-lg) */
	  max-inline-size: min(850px, 96vw);
	  inline-size: 100%;
	  max-block-size: 92vh;
	  max-block-size: 92dvh;
	  
	  overflow-y: auto;
	  overscroll-behavior: contain;
	  
	  display: flex;
	  flex-direction: column;
	  gap: var(--space-sm); /* REDUCIDO de var(--space-md) */
	  
	  animation: slideUp 400ms cubic-bezier(0.4, 0, 0.2, 1);
	  contain: layout style paint;
	}

  .modal-content::before {
    content: '';
    position: absolute;
    inset: 0px;
    border-radius: inherit;
    background: linear-gradient(
      90deg,
      var(--clr-neon-cyan),
      var(--clr-neon-pink),
      var(--clr-neon-yellow),
      var(--clr-neon-cyan)
    );
    background-size: 200% 100%;
    z-index: -1;
    will-change: background-position;
    animation: borderFlow 6s linear infinite;
    mask: 
      linear-gradient(#fff 0 0) content-box, 
      linear-gradient(#fff 0 0);
    mask-composite: exclude;
    -webkit-mask: 
      linear-gradient(#fff 0 0) content-box, 
      linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    padding: 2px;
  }

  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-block-end: var(--space-sm);
    border-block-end: 2px solid var(--clr-neon-cyan);
    gap: var(--space-sm);
    box-shadow: 0 4px 15px color-mix(in oklch, var(--clr-neon-cyan), transparent 70%);
  }

  .modal-title {
    font-family: 'Press Start 2P', cursive;
    font-size: var(--fs-md);
    color: var(--clr-neon-yellow);
    line-height: 1.5;
    text-shadow: 
      0 0 10px var(--clr-neon-yellow),
      0 0 20px color-mix(in oklch, var(--clr-neon-yellow), transparent 50%);
    word-wrap: break-word;
    flex: 1;
  }

  .close-btn {
    background: transparent;
    border: 2px solid var(--clr-neon-pink);
    color: var(--clr-neon-pink);
    inline-size: clamp(42px, 10cqi, 50px);
    block-size: clamp(42px, 10cqi, 50px);
    border-radius: var(--radius-full);
    
    cursor: pointer;
    font-size: var(--fs-lg);
    transition: all var(--transition-base);
    flex-shrink: 0;
    
    display: grid;
    place-items: center;
    
    box-shadow: 
      0 0 15px color-mix(in oklch, var(--clr-neon-pink), transparent 50%),
      inset 0 0 10px color-mix(in oklch, var(--clr-neon-pink), transparent 80%);
  }

  .close-btn:hover {
    background: var(--clr-neon-pink);
    color: white;
    transform: rotate(90deg) scale(1.1);
    box-shadow: 0 0 25px var(--clr-neon-pink);
  }

  /* Game Stats */
	.game-stats {
	  display: flex;
	  justify-content: space-around;
	  flex-wrap: wrap;
	  padding: var(--space-sm); /* REDUCIDO de var(--space-md) */
	  background: oklch(10% 0.03 255 / 0.5);
	  border-radius: var(--radius-md);
	  gap: var(--space-sm); /* REDUCIDO de var(--space-md) */
	  border: 2px solid color-mix(in oklch, var(--clr-neon-cyan), transparent 60%);
	  box-shadow: 
	    inset 0 0 20px color-mix(in oklch, var(--clr-neon-cyan), transparent 85%),
	    0 0 15px color-mix(in oklch, var(--clr-neon-cyan), transparent 70%);
	  flex-shrink: 0;
	}

  .stat {
    text-align: center;
    flex: 1;
    min-inline-size: min(80px, 100%);
  }

	.stat-value {
	  font-size: var(--fs-lg); /* REDUCIDO de var(--fs-xl) */
	  font-weight: 700;
	  color: var(--clr-neon-yellow);
	  font-family: 'Press Start 2P', cursive;
	  text-shadow: 
	    0 0 12px var(--clr-neon-yellow),
	    0 0 24px color-mix(in oklch, var(--clr-neon-yellow), transparent 50%);
	}

  .stat-label {
    font-size: var(--fs-xs);
    opacity: 0.7;
    text-transform: uppercase;
    margin-block-start: 0.3rem;
  }

  /* Catch Game Area */
	.catch-game-area {
	  position: relative;
	  inline-size: 100%;
	  max-inline-size: min(650px, 100%);
	  margin-inline: auto;
	  block-size: clamp(220px, 35vh, 520px); /* M√ÅS REDUCIDO */
	  block-size: clamp(220px, 35dvh, 400px);
	  
	  background: linear-gradient(180deg, 
	    oklch(15% 0.05 255) 0%, 
	    oklch(18% 0.06 270) 100%);
	  border: 2px solid transparent;
	  border-radius: var(--radius-lg);
	  overflow: hidden;
	  flex-shrink: 0;
	  contain: layout style paint;
	}

  .catch-game-area::before {
    content: '';
    position: absolute;
    inset: 0px;
    border-radius: inherit;
    background: linear-gradient(
      45deg,
      var(--clr-neon-cyan),
      var(--clr-neon-pink),
      var(--clr-neon-yellow),
      var(--clr-neon-cyan)
    );
    background-size: 200% 200%;
    z-index: -1;
    will-change: background-position;
    animation: borderGlow 8s ease-in-out infinite;
    mask: 
      linear-gradient(#fff 0 0) content-box, 
      linear-gradient(#fff 0 0);
    mask-composite: exclude;
    -webkit-mask: 
      linear-gradient(#fff 0 0) content-box, 
      linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    padding: 2px;
  }

  .catch-game-area::after {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(
      circle at center,
      transparent 0%,
      color-mix(in oklch, var(--clr-neon-cyan), transparent 90%) 100%
    );
    pointer-events: none;
  }

  .catcher {
    position: absolute;
    inset-block-end: clamp(15px, 3vh, 25px);
    inline-size: clamp(55px, 11vw, 75px);
    block-size: clamp(55px, 11vw, 75px);
    font-size: clamp(2.2rem, 5.5vw, 3rem);
    
    cursor: move;
    touch-action: none;
    user-select: none;
    
    filter: drop-shadow(0 0 12px var(--clr-neon-yellow));
    z-index: 100;
    
    display: grid;
    place-items: center;
    contain: layout style paint;
    will-change: transform;
  }

  .falling-item {
    position: absolute;
    font-size: clamp(1.8rem, 4.5vw, 2.5rem);
    pointer-events: none;
    user-select: none;
    filter: drop-shadow(0 0 8px currentColor);
    will-change: transform;
    animation: itemSpin 2s linear infinite;
  }

  .powerup {
    animation: itemSpin 2s linear infinite, powerupPulse 1s ease-in-out infinite;
  }

  /* Memory Game */
	.memory-grid {
	  display: grid;
	  grid-template-columns: repeat(4, minmax(0, 1fr)); /* CAMBIO CLAVE: minmax(0, 1fr) */
	  gap: clamp(0.4rem, 2cqi, 0.9rem);
	  max-inline-size: min(420px, 95%); /* REDUCIDO de 480px y cambiado a 95% */
	  inline-size: 100%; /* A√ëADIDO */
	  margin-inline: auto;
	  margin-block-end: var(--space-md);
	  padding-inline: var(--space-xs); /* A√ëADIDO padding */
	  flex-shrink: 0;
	  container-type: inline-size;
	  place-items: center; /* A√ëADIDO */
	}

	.memory-card {
	  aspect-ratio: 1;
	  inline-size: 100%; /* A√ëADIDO */
	  max-inline-size: 90px; /* A√ëADIDO l√≠mite */
	  min-block-size: clamp(55px, 15cqi, 90px);
	  
	  background: linear-gradient(135deg, 
	    color-mix(in oklch, var(--clr-neon-cyan), transparent 80%),
	    color-mix(in oklch, var(--clr-neon-purple), transparent 80%));
	  border: 3px solid var(--clr-neon-cyan);
	  border-radius: var(--radius-md);
	  
	  cursor: pointer;
	  user-select: none;
	  
	  display: grid;
	  place-items: center;
	  font-size: clamp(1.8rem, 6cqi, 3rem);
	  
	  transition: all var(--transition-slow);
	  box-shadow: 
	    0 0 15px color-mix(in oklch, var(--clr-neon-cyan), transparent 60%),
	    inset 0 0 15px color-mix(in oklch, var(--clr-neon-cyan), transparent 85%);
	  
	  contain: layout style paint;
	}

  .memory-card:hover:not(.flipped):not(.matched) {
    transform: scale(1.05);
    border-color: var(--clr-neon-pink);
    box-shadow: 
      0 0 25px color-mix(in oklch, var(--clr-neon-pink), transparent 40%),
      inset 0 0 20px color-mix(in oklch, var(--clr-neon-pink), transparent 70%);
  }

  .memory-card.flipped {
    background: linear-gradient(135deg, 
      color-mix(in oklch, var(--clr-neon-pink), transparent 50%),
      color-mix(in oklch, var(--clr-neon-purple), transparent 50%));
    border-color: var(--clr-neon-pink);
    transform: rotateY(180deg);
    box-shadow: 
      0 0 25px color-mix(in oklch, var(--clr-neon-pink), transparent 40%),
      inset 0 0 25px color-mix(in oklch, var(--clr-neon-pink), transparent 70%);
  }

  .memory-card.matched {
    background: linear-gradient(135deg, 
      color-mix(in oklch, var(--clr-neon-cyan), transparent 50%),
      color-mix(in oklch, var(--clr-neon-yellow), transparent 50%));
    border-color: var(--clr-neon-yellow);
    cursor: default;
    animation: matchFlash 600ms ease;
    box-shadow: 
      0 0 30px var(--clr-neon-yellow),
      inset 0 0 25px color-mix(in oklch, var(--clr-neon-yellow), transparent 60%);
  }

  /* Leaderboard */
  .leaderboard-section {
    position: relative;
    background: var(--clr-card-bg);
    border: 2px solid transparent;
    border-radius: var(--radius-lg);
    padding: var(--space-lg);
    backdrop-filter: blur(12px);
    contain: layout style paint;
    isolation: isolate;
  }

  .leaderboard-section::before {
    content: '';
    position: absolute;
    inset: 0px;
    border-radius: inherit;
    background: linear-gradient(
      135deg,
      var(--clr-neon-purple),
      var(--clr-neon-pink),
      var(--clr-neon-cyan),
      var(--clr-neon-purple)
    );
    background-size: 200% 200%;
    z-index: -1;
    will-change: background-position;
    animation: borderGlow 10s ease-in-out infinite;
    mask: 
      linear-gradient(#fff 0 0) content-box, 
      linear-gradient(#fff 0 0);
    mask-composite: exclude;
    -webkit-mask: 
      linear-gradient(#fff 0 0) content-box, 
      linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    padding: 2px;
  }

  .leaderboard-title {
    font-family: 'Press Start 2P', cursive;
    font-size: var(--fs-lg);
    text-align: center;
    margin-block-end: var(--space-lg);
    color: var(--clr-neon-yellow);
    line-height: 1.5;
    text-shadow: 
      0 0 15px var(--clr-neon-yellow),
      0 0 30px color-mix(in oklch, var(--clr-neon-yellow), transparent 50%);
    word-wrap: break-word;
  }

  .leaderboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(min(280px, 100%), 1fr));
    gap: var(--space-lg);
  }

  .leaderboard-box {
    background: oklch(10% 0.03 255 / 0.5);
    border: 2px solid color-mix(in oklch, var(--clr-neon-cyan), transparent 60%);
    border-radius: var(--radius-lg);
    padding: var(--space-md);
    box-shadow: 
      0 0 20px color-mix(in oklch, var(--clr-neon-cyan), transparent 70%),
      inset 0 0 25px color-mix(in oklch, var(--clr-neon-cyan), transparent 90%);
  }

  .leaderboard-box h3 {
    text-align: center;
    color: var(--clr-neon-pink);
    margin-block-end: var(--space-md);
    font-size: var(--fs-md);
    text-shadow: 
      0 0 12px var(--clr-neon-pink),
      0 0 24px color-mix(in oklch, var(--clr-neon-pink), transparent 50%);
    word-wrap: break-word;
  }

  .leaderboard-list {
    list-style: none;
  }

  .leaderboard-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--space-sm);
    margin-block-end: var(--space-xs);
    background: color-mix(in oklch, var(--clr-neon-cyan), transparent 92%);
    border: 2px solid color-mix(in oklch, var(--clr-neon-cyan), transparent 70%);
    border-radius: var(--radius-md);
    gap: var(--space-xs);
    transition: all var(--transition-base);
    contain: layout style paint;
  }

  .leaderboard-item:hover {
    background: color-mix(in oklch, var(--clr-neon-cyan), transparent 80%);
    transform: translateX(8px) scale(1.02);
    border-color: var(--clr-neon-cyan);
    box-shadow: 0 0 20px color-mix(in oklch, var(--clr-neon-cyan), transparent 50%);
  }

  .leaderboard-item.top-1 {
    background: linear-gradient(135deg, 
      oklch(70% 0.15 85 / 0.4),
      oklch(65% 0.12 85 / 0.3));
    border: 2px solid oklch(80% 0.15 85);
    box-shadow: 
      0 0 25px oklch(80% 0.15 85 / 0.6),
      inset 0 0 20px oklch(80% 0.15 85 / 0.2);
  }

  .leaderboard-item.top-2 {
    background: linear-gradient(135deg, 
      oklch(75% 0.01 0 / 0.4),
      oklch(70% 0.01 0 / 0.3));
    border: 2px solid oklch(80% 0.01 0);
    box-shadow: 
      0 0 25px oklch(80% 0.01 0 / 0.6),
      inset 0 0 20px oklch(80% 0.01 0 / 0.2);
  }

  .leaderboard-item.top-3 {
    background: linear-gradient(135deg, 
      oklch(60% 0.12 55 / 0.4),
      oklch(55% 0.10 55 / 0.3));
    border: 2px solid oklch(65% 0.12 55);
    box-shadow: 
      0 0 25px oklch(65% 0.12 55 / 0.6),
      inset 0 0 20px oklch(65% 0.12 55 / 0.2);
  }

  .leaderboard-rank {
    font-size: var(--fs-md);
    font-weight: 700;
    min-inline-size: clamp(35px, 10cqi, 50px);
    text-align: center;
    text-shadow: 0 0 8px currentColor;
  }

  .leaderboard-name {
    flex: 1;
    margin-inline: var(--space-xs);
    font-weight: 600;
    font-size: var(--fs-sm);
    word-break: break-word;
    overflow-wrap: break-word;
  }

  .leaderboard-score {
    font-size: var(--fs-md);
    font-weight: 700;
    color: var(--clr-neon-yellow);
    text-shadow: 
      0 0 10px var(--clr-neon-yellow),
      0 0 20px color-mix(in oklch, var(--clr-neon-yellow), transparent 50%);
  }

  .no-scores {
    text-align: center;
    opacity: 0.5;
    padding: var(--space-lg);
    font-style: italic;
    font-size: var(--fs-sm);
  }

  /* Game Over Alert */
  .game-over-alert {
    position: fixed;
    inset-block-start: 50%;
    inset-inline-start: 50%;
    transform: translate(-50%, -50%) scale(0);
    
    background: linear-gradient(135deg, 
      var(--clr-neon-purple), 
      var(--clr-neon-pink));
    padding: var(--space-xl);
    border-radius: var(--radius-lg);
    border: 3px solid var(--clr-neon-cyan);
    
    box-shadow: 
      0 0 80px color-mix(in oklch, var(--clr-neon-cyan), transparent 20%),
      0 0 50px color-mix(in oklch, var(--clr-neon-pink), transparent 40%),
      inset 0 0 30px color-mix(in oklch, white, transparent 70%);
    
    text-align: center;
    z-index: var(--z-alert);
    max-inline-size: min(480px, 92vw);
    
    transition: transform var(--transition-slow);
    contain: layout style paint;
  }

  .game-over-alert.active {
    transform: translate(-50%, -50%) scale(1);
    animation: alertPulse 1s ease-in-out;
  }

  .game-over-alert h2 {
    font-family: 'Press Start 2P', cursive;
    font-size: var(--fs-xl);
    margin-block-end: var(--space-sm);
    color: var(--clr-neon-yellow);
    line-height: 1.5;
    text-shadow: 
      0 0 20px var(--clr-neon-yellow),
      0 0 40px color-mix(in oklch, white, transparent 20%);
    word-wrap: break-word;
  }

  .final-score-display {
    font-size: var(--fs-3xl);
    font-weight: 900;
    color: white;
    margin-block: var(--space-sm);
    text-shadow: 
      0 0 25px white,
      0 0 50px var(--clr-neon-cyan),
      0 0 75px color-mix(in oklch, var(--clr-neon-pink), transparent 40%);
  }

  /* Scrollbar */
  .modal-content::-webkit-scrollbar {
    inline-size: 10px;
  }

  .modal-content::-webkit-scrollbar-track {
    background: oklch(10% 0.03 255 / 0.4);
    border-radius: var(--radius-sm);
    box-shadow: inset 0 0 8px color-mix(in oklch, var(--clr-neon-cyan), transparent 80%);
  }

  .modal-content::-webkit-scrollbar-thumb {
    background: linear-gradient(180deg, 
      var(--clr-neon-cyan), 
      var(--clr-neon-purple));
    border-radius: var(--radius-sm);
    box-shadow: 0 0 8px color-mix(in oklch, var(--clr-neon-cyan), transparent 40%);
  }

  .modal-content::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(180deg, 
      var(--clr-neon-pink), 
      var(--clr-neon-yellow));
    box-shadow: 0 0 12px var(--clr-neon-pink);
  }

  /* Scrollbar for Firefox */
  .modal-content {
    scrollbar-width: thin;
    scrollbar-color: var(--clr-neon-cyan) oklch(10% 0.03 255 / 0.4);
  }

  .modal-content > div:last-of-type {
	  flex-shrink: 0; /* Evitar que se comprima */
	  margin-block-start: auto; /* Empujar hacia abajo si hay espacio */
	}

	/* Neon Runner Game */
	.runner-game-area {
	    position: relative;
	    inline-size: 100%;
	    max-inline-size: min(650px, 100%);
	    margin-inline: auto;
	    block-size: clamp(220px, 35vh, 400px);
	    
	    background: linear-gradient(180deg, 
	        oklch(15% 0.05 255) 0%, 
	        oklch(18% 0.06 270) 100%);
	    border: 2px solid transparent;
	    border-radius: var(--radius-lg);
	    overflow: hidden;
	    flex-shrink: 0;
	    contain: layout style paint;
	}

	.runner-game-area::before {
	    content: '';
	    position: absolute;
	    inset: 0px;
	    border-radius: inherit;
	    background: linear-gradient(
	        45deg,
	        var(--clr-neon-cyan),
	        var(--clr-neon-pink),
	        var(--clr-neon-yellow),
	        var(--clr-neon-cyan)
	    );
	    background-size: 200% 200%;
	    z-index: -1;
	    will-change: background-position;
	    animation: borderGlow 8s ease-in-out infinite;
	    mask: 
	        linear-gradient(#fff 0 0) content-box, 
	        linear-gradient(#fff 0 0);
	    mask-composite: exclude;
	    -webkit-mask: 
	        linear-gradient(#fff 0 0) content-box, 
	        linear-gradient(#fff 0 0);
	    -webkit-mask-composite: xor;
	    padding: 2px;
	}

	.runner-ground {
	    position: absolute;
	    inset-block-end: 0;
	    inline-size: 100%;
	    block-size: 4px;
	    background: linear-gradient(90deg, 
	        var(--clr-neon-cyan), 
	        var(--clr-neon-pink), 
	        var(--clr-neon-yellow));
	    background-size: 200% 100%;
	    animation: groundScroll 1s linear infinite;
	    box-shadow: 0 0 15px var(--clr-neon-cyan);
	}

	.runner-player {
	    position: absolute;
	    inset-block-end: 4px;
	    inset-inline-start: clamp(40px, 10%, 80px);
	    inline-size: clamp(45px, 10vw, 60px);
	    block-size: clamp(45px, 10vw, 60px);
	    font-size: clamp(2rem, 5vw, 2.5rem);
	    
	    display: grid;
	    place-items: center;
	    
	    filter: drop-shadow(0 0 12px var(--clr-neon-yellow));
	    z-index: 10;
	    
	    contain: layout style paint;
	    will-change: transform;
	    transition: transform 0.1s ease-out;

	    transform: scaleX(-1);
	}

	.runner-player.jumping {
	}

	.runner-obstacle {
	    position: absolute;
	    inset-block-end: 4px;
	    inline-size: clamp(35px, 8vw, 50px);
	    block-size: clamp(35px, 8vw, 50px);
	    font-size: clamp(1.5rem, 4vw, 2rem);
	    
	    display: grid;
	    place-items: center;
	    
	    filter: drop-shadow(0 0 8px currentColor);
	    will-change: transform;
	    animation: obstacleMove linear;
	}

	/* Space Invaders Game */
.invaders-game-area {
    position: relative;
    inline-size: 100%;
    max-inline-size: min(650px, 100%);
    margin-inline: auto;
    block-size: clamp(300px, 45vh, 500px);
    
    background: linear-gradient(180deg, 
        oklch(5% 0.08 270) 0%, 
        oklch(10% 0.05 255) 50%,
        oklch(15% 0.05 255) 100%);
    border: 2px solid transparent;
    border-radius: var(--radius-lg);
    overflow: hidden;
    flex-shrink: 0;
    contain: layout style paint;
}

.invaders-game-area::before {
    content: '';
    position: absolute;
    inset: 0px;
    border-radius: inherit;
    background: linear-gradient(
        45deg,
        var(--clr-neon-purple),
        var(--clr-neon-pink),
        var(--clr-neon-cyan),
        var(--clr-neon-purple)
    );
    background-size: 200% 200%;
    z-index: -1;
    will-change: background-position;
    animation: borderGlow 8s ease-in-out infinite;
    mask: 
        linear-gradient(#fff 0 0) content-box, 
        linear-gradient(#fff 0 0);
    mask-composite: exclude;
    -webkit-mask: 
        linear-gradient(#fff 0 0) content-box, 
        linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    padding: 2px;
}

.invaders-player {
    position: absolute;
    inset-block-end: 20px;
    inline-size: clamp(40px, 8vw, 55px);
    block-size: clamp(40px, 8vw, 55px);
    font-size: clamp(1.8rem, 4vw, 2.5rem);
    
    display: grid;
    place-items: center;
    
    filter: drop-shadow(0 0 15px var(--clr-neon-cyan));
    z-index: 10;
    
    contain: layout style paint;
    will-change: transform;
    transition: left 0.1s ease-out;
}

.invader {
    position: absolute;
    inline-size: clamp(30px, 6vw, 45px);
    block-size: clamp(30px, 6vw, 45px);
    font-size: clamp(1.5rem, 3.5vw, 2rem);
    
    display: grid;
    place-items: center;
    
    filter: drop-shadow(0 0 8px var(--clr-neon-pink));
    will-change: transform;
    animation: invaderFloat 2s ease-in-out infinite;
}

.bullet {
    position: absolute;
    inline-size: 4px;
    block-size: clamp(12px, 3vw, 18px);
    background: linear-gradient(180deg, 
        var(--clr-neon-yellow), 
        var(--clr-neon-cyan));
    border-radius: var(--radius-full);
    box-shadow: 
        0 0 10px var(--clr-neon-yellow),
        0 0 20px var(--clr-neon-cyan);
    will-change: transform;
}

.enemy-bullet {
    background: linear-gradient(180deg, 
        var(--clr-neon-pink), 
        var(--clr-neon-purple));
    box-shadow: 
        0 0 10px var(--clr-neon-pink),
        0 0 20px var(--clr-neon-purple);
}

.explosion {
    position: absolute;
    font-size: clamp(2rem, 5vw, 3rem);
    pointer-events: none;
    animation: explode 0.5s ease-out forwards;
    z-index: 100;
}

/* Symbol buttons */
.symbol-btn {
    padding: 0.3rem 0.6rem;
    background: rgba(0, 255, 255, 0.1);
    border: 1px solid rgba(0, 255, 255, 0.3);
    border-radius: var(--radius-sm);
    color: var(--clr-neon-cyan);
    font-size: 1rem;
    cursor: pointer;
    transition: all var(--transition-fast);
}

.symbol-btn:hover {
    background: rgba(0, 255, 255, 0.2);
    border-color: var(--clr-neon-cyan);
    transform: scale(1.1);
    box-shadow: 0 0 10px rgba(0, 255, 255, 0.4);
}

.symbol-btn:active {
    transform: scale(0.95);
}
}


/* ============================================
   LAYER: ANIMATIONS
============================================ */
@layer animations {
  
  @keyframes gridMove {
    from { transform: perspective(500px) rotateX(60deg) translateY(0); }
    to { transform: perspective(500px) rotateX(60deg) translateY(50px); }
  }

  @keyframes particleFloat {
    0%, 100% { 
      background-position: 0% 0%, 100% 100%, 50% 50%; 
    }
    33% { 
      background-position: 100% 0%, 0% 50%, 80% 20%; 
    }
    66% { 
      background-position: 0% 100%, 100% 20%, 20% 80%; 
    }
  }

  @keyframes lightRotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }

  @keyframes twinkle {
    0%, 100% { 
      opacity: 0.3; 
      transform: scale(0.9);
    }
    50% { 
      opacity: 1; 
      transform: scale(1.1);
    }
  }

  @keyframes gradientFlow {
    from { background-position: 0% center; }
    to { background-position: 200% center; }
  }

  @keyframes borderFlow {
    from { background-position: 0% center; }
    to { background-position: 200% center; }
  }

  @keyframes borderGlow {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
  }

  @keyframes itemSpin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }

  @keyframes powerupPulse {
    0%, 100% { 
      transform: scale(1); 
      filter: drop-shadow(0 0 8px currentColor);
    }
    50% { 
      transform: scale(1.15); 
      filter: drop-shadow(0 0 16px currentColor);
    }
  }

  @keyframes matchFlash {
    0% { 
      transform: scale(1); 
      filter: brightness(1);
    }
    25% { 
      transform: scale(1.15) rotate(5deg); 
      filter: brightness(1.5);
    }
    50% { 
      transform: scale(1.1) rotate(-5deg); 
      filter: brightness(2);
    }
    75% { 
      transform: scale(1.15) rotate(3deg); 
      filter: brightness(1.5);
    }
    100% { 
      transform: scale(1) rotate(0deg); 
      filter: brightness(1);
    }
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  @keyframes slideUp {
    from { 
      transform: translateY(20px); 
      opacity: 0; 
    }
    to { 
      transform: translateY(0); 
      opacity: 1; 
    }
  }

  @keyframes alertPulse {
    0% { 
      transform: translate(-50%, -50%) scale(0) rotate(0deg); 
    }
    50% { 
      transform: translate(-50%, -50%) scale(1.08) rotate(3deg); 
    }
    75% { 
      transform: translate(-50%, -50%) scale(0.96) rotate(-2deg); 
    }
    100% { 
      transform: translate(-50%, -50%) scale(1) rotate(0deg); 
    }
  }

  @keyframes groundScroll {
	    from { background-position: 0% center; }
	    to { background-position: 200% center; }
	}

@keyframes playerJump {
    /* Ya no se usa, pero la dejamos por compatibilidad */
    0% { transform: scaleX(-1) translateY(0); }
    50% { transform: scaleX(-1) translateY(-120px); }
    100% { transform: scaleX(-1) translateY(0); }
}

	@keyframes obstacleMove {
	    from { transform: translateX(0); }
	    to { transform: translateX(-100vw); }
	}

	@keyframes invaderFloat {
	    0%, 100% { transform: translateY(0) rotate(0deg); }
	    50% { transform: translateY(-5px) rotate(5deg); }
	}

	@keyframes explode {
	    0% { 
	        transform: scale(0.5); 
	        opacity: 1; 
	    }
	    100% { 
	        transform: scale(2); 
	        opacity: 0; 
	    }
	}
}

/* ============================================
   LAYER: UTILITIES
============================================ */
@layer utilities {
  
  .visually-hidden {
    position: absolute;
    inline-size: 1px;
    block-size: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
  }

  .skip-to-content {
    position: absolute;
    inset-block-start: -100%;
    inset-inline-start: 50%;
    transform: translateX(-50%);
    padding: var(--space-sm) var(--space-md);
    background: var(--clr-neon-cyan);
    color: var(--clr-bg-darker);
    font-weight: 700;
    border-radius: var(--radius-sm);
    z-index: var(--z-modal);
    transition: inset-block-start var(--transition-base);
  }

  .skip-to-content:focus {
    inset-block-start: var(--space-sm);
  }
}

/* ============================================
   RESPONSIVE & ACCESSIBILITY
============================================ */

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* High Contrast */
@media (prefers-contrast: high) {
  .game-card,
  .user-panel,
  .leaderboard-section,
  .modal-content {
    border-width: 4px;
  }
  
  .stat-value,
  .leaderboard-score,
  .final-score-display {
    font-weight: 900;
  }
}

/* Touch Devices */
@media (hover: none) and (pointer: coarse) {
  .game-card,
  .arcade-btn,
  .memory-card,
  .leaderboard-item,
  .close-btn {
    transition-duration: 100ms;
  }
  
  .game-card:active {
    transform: scale(0.98);
  }
  
  .arcade-btn:active {
    transform: scale(0.96);
  }
  
  .memory-card:active:not(.flipped):not(.matched) {
    transform: scale(0.95);
  }
  
  .close-btn:active {
    transform: scale(0.95) rotate(90deg);
  }
}

/* Container Queries */
@container (inline-size < 400px) {
  .memory-grid {
    gap: 0.3rem;
  }
  
  .game-stats {
    flex-direction: column;
  }
  
  .stat {
    min-inline-size: 100%;
  }
}

@container (inline-size > 800px) {
  .games-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

/* Print Styles */
@media print {
  .animated-bg,
  .arcade-btn,
  .close-btn {
    display: none;
  }
  
  body {
    background: white;
    color: black;
  }
  
  .game-card,
  .leaderboard-section {
    break-inside: avoid;
  }
}
</style>
<script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>

<script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
</head>
<body>
	<!-- Animated Background Layer -->
	<div class="animated-bg">
		<div class="grid-lines"></div>
		<div class="stars" id="starsContainer"></div>
	</div>

	<!-- Skip to main content for accessibility -->
	<a href="#main-content" class="skip-to-content">Skip to main content</a>

	<div class="container">
		<!-- Header Section -->
		<header class="header">
			<h1 data-text="ARCADE ZONE">ARCADE ZONE</h1>
			<p>‚óÜ ELITE MULTIPLAYER ARENA ‚óÜ</p>
		</header>

		<!-- User Authentication Panel -->
		<section class="user-panel" aria-label="User authentication">
			<div id="loginView">
				<button class="arcade-btn" onclick="loginWithGoogle()" aria-label="Sign in with Google">
					<span aria-hidden="true">‚òÖ</span> SIGN IN WITH GOOGLE <span aria-hidden="true">‚òÖ</span>
				</button>
			</div>

			<div id="userView" style="display: none;">
			    <div class="user-info">
			        <div class="user-avatar" aria-hidden="true">üéÆ</div>
			        <div>
			            <div class="user-name" id="displayUsername"></div>
			            <div style="font-size: 0.8rem; opacity: 0.7;">ACTIVE PLAYER</div>
			        </div>
			    </div>
			    <div style="display: flex; gap: var(--space-sm); flex-wrap: wrap;">
			        <!-- ‚úÖ NUEVO: Bot√≥n de cambiar nickname -->
			        <button class="arcade-btn" onclick="openChangeNickname()" aria-label="Change nickname" style="background: linear-gradient(135deg, var(--clr-neon-cyan), var(--clr-neon-purple));">
			            <span aria-hidden="true">‚úèÔ∏è</span> CHANGE NICK
			        </button>
			        <button class="arcade-btn" onclick="logout()" aria-label="Logout from account">
			            <span aria-hidden="true">‚èè</span> LOGOUT
			        </button>
			    </div>
			</div>
		</section>

		<!-- Main Games Grid -->
		<main id="main-content" class="games-grid">
			<!-- Star Catcher Game Card -->
			<article class="game-card" onclick="openGame('catch')" tabindex="0" role="button" aria-label="Play Star Catcher game">
				<div class="game-icon" aria-hidden="true">‚≠ê</div>
				<h2 class="game-title">STAR CATCHER</h2>
				<p class="game-description">
					Catch falling stars and power-ups! Dodge deadly bombs and chase the highest score in this fast-paced arcade challenge.
				</p>
				<div class="game-stats-preview" aria-label="Star Catcher statistics">
					<div class="stat-preview">
						<div class="stat-preview-value" id="catchBestPreview">-</div>
						<div class="stat-preview-label">Your Best</div>
					</div>
					<div class="stat-preview">
						<div class="stat-preview-value" id="catchWorldPreview">-</div>
						<div class="stat-preview-label">World #1</div>
					</div>
				</div>
				<div style="text-align: center; margin-top: 1rem;">
					<button class="arcade-btn" onclick="event.stopPropagation(); openGame('catch')" aria-label="Start Star Catcher">
						<span aria-hidden="true">‚ñ∂</span> PLAY NOW
					</button>
				</div>
			</article>

			<!-- Memory Master Game Card -->
			<article class="game-card" onclick="openGame('memory')" tabindex="0" role="button" aria-label="Play Memory Master game">
				<div class="game-icon" aria-hidden="true">üß†</div>
				<h2 class="game-title">MEMORY MASTER</h2>
				<p class="game-description">
					Test your memory skills! Match all emoji pairs with the fewest moves possible. Can you achieve perfection?
				</p>
				<div class="game-stats-preview" aria-label="Memory Master statistics">
					<div class="stat-preview">
						<div class="stat-preview-value" id="memoryBestPreview">-</div>
						<div class="stat-preview-label">Your Best</div>
					</div>
					<div class="stat-preview">
						<div class="stat-preview-value" id="memoryWorldPreview">-</div>
						<div class="stat-preview-label">World #1</div>
					</div>
				</div>
				<div style="text-align: center; margin-top: 1rem;">
					<button class="arcade-btn" onclick="event.stopPropagation(); openGame('memory')" aria-label="Start Memory Master">
						<span aria-hidden="true">‚ñ∂</span> PLAY NOW
					</button>
				</div>
			</article>

			<!-- Neon Runner Game Card -->
			<article class="game-card" onclick="openGame('runner')" tabindex="0" role="button" aria-label="Play Neon Runner game">
			    <div class="game-icon" aria-hidden="true">üèÉ</div>
			    <h2 class="game-title">NEON RUNNER</h2>
			    <p class="game-description">
			        Jump over obstacles in this endless runner! Time your jumps perfectly and survive as long as possible.
			    </p>
			    <div class="game-stats-preview" aria-label="Neon Runner statistics">
			        <div class="stat-preview">
			            <div class="stat-preview-value" id="runnerBestPreview">-</div>
			            <div class="stat-preview-label">Your Best</div>
			        </div>
			        <div class="stat-preview">
			            <div class="stat-preview-value" id="runnerWorldPreview">-</div>
			            <div class="stat-preview-label">World #1</div>
			        </div>
			    </div>
			    <div style="text-align: center; margin-top: 1rem;">
			        <button class="arcade-btn" onclick="event.stopPropagation(); openGame('runner')" aria-label="Start Neon Runner">
			            <span aria-hidden="true">‚ñ∂</span> PLAY NOW
			        </button>
			    </div>
			</article>

			<!-- Space Invaders Game Card -->
			<article class="game-card" onclick="openGame('invaders')" tabindex="0" role="button" aria-label="Play Space Invaders Remix game">
			    <div class="game-icon" aria-hidden="true">üëæ</div>
			    <h2 class="game-title">SPACE INVADERS</h2>
			    <p class="game-description">
			        Defend Earth from alien invaders! Shoot them down before they reach your base. Classic arcade action!
			    </p>
			    <div class="game-stats-preview" aria-label="Space Invaders statistics">
			        <div class="stat-preview">
			            <div class="stat-preview-value" id="invadersBestPreview">-</div>
			            <div class="stat-preview-label">Your Best</div>
			        </div>
			        <div class="stat-preview">
			            <div class="stat-preview-value" id="invadersWorldPreview">-</div>
			            <div class="stat-preview-label">World #1</div>
			        </div>
			    </div>
			    <div style="text-align: center; margin-top: 1rem;">
			        <button class="arcade-btn" onclick="event.stopPropagation(); openGame('invaders')" aria-label="Start Space Invaders">
			            <span aria-hidden="true">‚ñ∂</span> PLAY NOW
			        </button>
			    </div>
			</article>
		</main>

		<!-- Global Leaderboard Section -->
		<section class="leaderboard-section" aria-label="Global leaderboards">
    <h2 class="leaderboard-title">‚óÜ GLOBAL RANKINGS ‚óÜ</h2>

    <!-- FILA 1 -->
    <div class="leaderboard-grid">
        <div class="leaderboard-box">
            <h3><span aria-hidden="true">‚≠ê</span> STAR CATCHER</h3>
            <ul class="leaderboard-list" id="catchLeaderboard" role="list">
                <li class="no-scores">Loading rankings...</li>
            </ul>
        </div>

        <div class="leaderboard-box">
            <h3><span aria-hidden="true">üß†</span> MEMORY MASTER</h3>
            <ul class="leaderboard-list" id="memoryLeaderboard" role="list">
                <li class="no-scores">Loading rankings...</li>
            </ul>
        </div>
    </div>

    <!-- FILA 2 -->
    <div class="leaderboard-grid">
        <div class="leaderboard-box">
            <h3><span aria-hidden="true">üèÉ</span> NEON RUNNER</h3>
            <ul class="leaderboard-list" id="runnerLeaderboard" role="list">
                <li class="no-scores">Loading rankings...</li>
            </ul>
        </div>

        <div class="leaderboard-box">
            <h3><span aria-hidden="true">üëæ</span> SPACE INVADERS</h3>
            <ul class="leaderboard-list" id="invadersLeaderboard" role="list">
                <li class="no-scores">Loading rankings...</li>
            </ul>
        </div>
    </div>
</section>

	</div>

	<!-- Star Catcher Game Modal -->
	<div class="modal" id="catchModal" role="dialog" aria-labelledby="catchModalTitle" aria-modal="true">
		<div class="modal-content">
			<div class="modal-header">
				<h2 class="modal-title" id="catchModalTitle"><span aria-hidden="true">‚≠ê</span> STAR CATCHER</h2>
				<button class="close-btn" onclick="closeGame('catch')" aria-label="Close game">√ó</button>
			</div>

			<div class="game-stats" role="status" aria-live="polite">
				<div class="stat">
					<div class="stat-value" id="catchScore" aria-label="Current score">0</div>
					<div class="stat-label">Score</div>
				</div>
				<div class="stat">
					<div class="stat-value" id="catchTime" aria-label="Time remaining">30</div>
					<div class="stat-label">Time</div>
				</div>
				<div class="stat">
					<div class="stat-value" id="catchMultiplier" aria-label="Score multiplier">x1</div>
					<div class="stat-label">Combo</div>
				</div>
			</div>

			<div class="catch-game-area" id="catchGameArea" role="application" aria-label="Game area">
				<div class="catcher" id="catcher" aria-label="Player catcher">üéØ</div>
			</div>

			<div style="text-align: center;">
				<button class="arcade-btn" onclick="startCatchGame()" id="catchStartBtn">
					<span aria-hidden="true">üöÄ</span> START GAME
				</button>
			</div>

			<div style="margin-top: 2rem; padding: 1rem; background: rgba(0,0,0,0.3); border-radius: 10px; font-size: 0.9rem; line-height: 1.6;">
			    <strong style="color: var(--clr-neon-cyan);">üíé POWER-UPS GUIDE:</strong><br>
			
			    <div style="display: flex; gap: 0.8rem; flex-wrap: wrap; font-size: 0.8rem; margin-top: 0.5rem;">
			
			        <div style="white-space: nowrap;">
			            <span aria-hidden="true">‚ö°</span>
			            <strong>Speed Boost</strong> ‚Äì Faster star fall
			        </div>
			        <div style="white-space: nowrap;">
			            <span aria-hidden="true">üåü</span>
			            <strong>Double Points</strong> ‚Äì Score multiplier x2
			        </div>
			        <div style="white-space: nowrap;">
			            <span aria-hidden="true">‚è∞</span>
			            <strong>Time Extension</strong> ‚Äì +10 seconds bonus
			        </div>
			        <div style="white-space: nowrap;">
			            <span aria-hidden="true">üõ°Ô∏è</span>
			            <strong>Shield</strong> ‚Äì Bomb protection
			        </div>
			    </div>
			</div>
		</div>
	</div>

	<!-- Memory Master Game Modal -->
	<div class="modal" id="memoryModal" role="dialog" aria-labelledby="memoryModalTitle" aria-modal="true">
		<div class="modal-content">
			<div class="modal-header">
				<h2 class="modal-title" id="memoryModalTitle"><span aria-hidden="true">üß†</span> MEMORY MASTER</h2>
				<button class="close-btn" onclick="closeGame('memory')" aria-label="Close game">√ó</button>
			</div>

			<div class="game-stats" role="status" aria-live="polite">
				<div class="stat">
					<div class="stat-value" id="memoryMoves" aria-label="Total moves">0</div>
					<div class="stat-label">Moves</div>
				</div>
				<div class="stat">
					<div class="stat-value" id="memoryPairs" aria-label="Pairs matched">0/8</div>
					<div class="stat-label">Matched</div>
				</div>
			</div>

			<div class="memory-grid" id="memoryGrid" role="application" aria-label="Memory game grid"></div>

			<div style="text-align: center;">
				<button class="arcade-btn" onclick="initMemoryGame()">
					<span aria-hidden="true">üîÑ</span> NEW GAME
				</button>
			</div>

			<div style="margin-top: 1.5rem; padding: 1rem; background: rgba(0,0,0,0.3); border-radius: 10px; font-size: 0.85rem; text-align: center; opacity: 0.8;">
				<strong>Pro tip:</strong> Focus on patterns and positions. The fewer moves, the better your score!
			</div>
		</div>
	</div>

	<!-- Neon Runner Game Modal -->
	<div class="modal" id="runnerModal" role="dialog" aria-labelledby="runnerModalTitle" aria-modal="true">
	    <div class="modal-content">
	        <div class="modal-header">
	            <h2 class="modal-title" id="runnerModalTitle"><span aria-hidden="true">üèÉ</span> NEON RUNNER</h2>
	            <button class="close-btn" onclick="closeGame('runner')" aria-label="Close game">√ó</button>
	        </div>

	        <div class="game-stats" role="status" aria-live="polite">
	            <div class="stat">
	                <div class="stat-value" id="runnerScore" aria-label="Current score">0</div>
	                <div class="stat-label">Distance</div>
	            </div>
	            <div class="stat">
	                <div class="stat-value" id="runnerSpeed" aria-label="Current speed">1.0x</div>
	                <div class="stat-label">Speed</div>
	            </div>
	        </div>

	        <div class="runner-game-area" id="runnerGameArea" role="application" aria-label="Game area">
	            <div class="runner-player" id="runnerPlayer" aria-label="Player character">üèÉ</div>
	            <div class="runner-ground"></div>
	        </div>

	        <div style="text-align: center;">
	            <button class="arcade-btn" onclick="startRunnerGame()" id="runnerStartBtn">
	                <span aria-hidden="true">üöÄ</span> START RUNNING
	            </button>
	        </div>

	        <div style="margin-top: 2rem; padding: 1rem; background: rgba(0,0,0,0.3); border-radius: 10px; font-size: 0.9rem; line-height: 1.6;">
	            <strong style="color: var(--clr-neon-cyan);">üéÆ CONTROLS:</strong><br>
	            <div style="display: flex; gap: 1rem; flex-wrap: wrap; font-size: 0.85rem; margin-top: 0.5rem;">
	                <div><strong>SPACEBAR</strong> or <strong>CLICK</strong> ‚Äì Jump</div>
	                <div><strong>Hold</strong> ‚Äì Higher Jump</div>
	            </div>
	        </div>
	    </div>
	</div>

	<!-- Space Invaders Game Modal -->
	<div class="modal" id="invadersModal" role="dialog" aria-labelledby="invadersModalTitle" aria-modal="true">
	    <div class="modal-content">
	        <div class="modal-header">
	            <h2 class="modal-title" id="invadersModalTitle"><span aria-hidden="true">üëæ</span> SPACE INVADERS</h2>
	            <button class="close-btn" onclick="closeGame('invaders')" aria-label="Close game">√ó</button>
	        </div>

	        <div class="game-stats" role="status" aria-live="polite">
	            <div class="stat">
	                <div class="stat-value" id="invadersScore" aria-label="Current score">0</div>
	                <div class="stat-label">Score</div>
	            </div>
	            <div class="stat">
	                <div class="stat-value" id="invadersLives" aria-label="Lives remaining">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
	                <div class="stat-label">Lives</div>
	            </div>
	            <div class="stat">
	                <div class="stat-value" id="invadersWave" aria-label="Current wave">1</div>
	                <div class="stat-label">Wave</div>
	            </div>
	        </div>

	        <div class="invaders-game-area" id="invadersGameArea" role="application" aria-label="Game area">
	            <div class="invaders-player" id="invadersPlayer" aria-label="Player ship">üöÄ</div>
	        </div>

	        <div style="text-align: center;">
	            <button class="arcade-btn" onclick="startInvadersGame()" id="invadersStartBtn">
	                <span aria-hidden="true">üöÄ</span> START DEFENSE
	            </button>
	        </div>

	        <div style="margin-top: 2rem; padding: 1rem; background: rgba(0,0,0,0.3); border-radius: 10px; font-size: 0.9rem; line-height: 1.6;">
	            <strong style="color: var(--clr-neon-cyan);">üéÆ CONTROLS:</strong><br>
	            <div style="display: flex; gap: 1rem; flex-wrap: wrap; font-size: 0.85rem; margin-top: 0.5rem;">
	                <div><strong>ARROWS</strong> or <strong>A/D</strong> ‚Äì Move</div>
	                <div><strong>SPACEBAR</strong> ‚Äì Shoot</div>
	                <div><strong>MOUSE</strong> ‚Äì Click to move & shoot</div>
	            </div>
	        </div>
	    </div>
	</div>

	<!-- Game Over Alert -->
	<div class="game-over-alert" id="gameOverAlert" role="alertdialog" aria-labelledby="gameOverTitle">
		<div style="font-size: 4rem;" aria-hidden="true">üèÜ</div>
		<h2 id="gameOverTitle">GAME OVER!</h2>
		<p style="opacity: 0.8; margin-bottom: 0.5rem;">YOUR FINAL SCORE</p>
		<div class="final-score-display" id="finalScore" aria-live="assertive">0</div>
		<button class="arcade-btn" onclick="closeGameOverAlert()" style="margin-top: 1rem;">
			<span aria-hidden="true">‚úì</span> CONTINUE
		</button>
	</div>

	<!-- Memory Victory Alert -->
	<div class="game-over-alert" id="memoryVictoryAlert" role="alertdialog" aria-labelledby="victoryTitle">
		<div style="font-size: 4rem;" aria-hidden="true">üéâ</div>
		<h2 id="victoryTitle">PERFECT MATCH!</h2>
		<p style="opacity: 0.8; margin-bottom: 0.5rem;">COMPLETED IN</p>
		<div class="final-score-display" id="finalMoves" aria-live="assertive">0</div>
		<p style="font-size: 1.2rem; margin-top: 0.5rem; opacity: 0.9;">MOVES</p>
		<button class="arcade-btn" onclick="closeMemoryVictory()" style="margin-top: 1rem;">
			<span aria-hidden="true">üîÑ</span> PLAY AGAIN
		</button>
	</div>

	<!-- Runner Game Over Alert -->
	<div class="game-over-alert" id="runnerGameOverAlert" role="alertdialog" aria-labelledby="runnerGameOverTitle">
	    <div style="font-size: 4rem;" aria-hidden="true">üí•</div>
	    <h2 id="runnerGameOverTitle">CRASH!</h2>
	    <p style="opacity: 0.8; margin-bottom: 0.5rem;">YOU RAN</p>
	    <div class="final-score-display" id="runnerFinalScore" aria-live="assertive">0</div>
	    <p style="font-size: 1.2rem; margin-top: 0.5rem; opacity: 0.9;">METERS</p>
	    <button class="arcade-btn" onclick="closeRunnerGameOver()" style="margin-top: 1rem;">
	        <span aria-hidden="true">üîÑ</span> TRY AGAIN
	    </button>
	</div>

	<!-- Invaders Game Over Alert -->
	<div class="game-over-alert" id="invadersGameOverAlert" role="alertdialog" aria-labelledby="invadersGameOverTitle">
	    <div style="font-size: 4rem;" aria-hidden="true">üíÄ</div>
	    <h2 id="invadersGameOverTitle">INVADED!</h2>
	    <p style="opacity: 0.8; margin-bottom: 0.5rem;">FINAL SCORE</p>
	    <div class="final-score-display" id="invadersFinalScore" aria-live="assertive">0</div>
	    <p style="font-size: 1rem; margin-top: 0.5rem; opacity: 0.9;">Waves Survived: <span id="invadersFinalWave">0</span></p>
	    <button class="arcade-btn" onclick="closeInvadersGameOver()" style="margin-top: 1rem;">
	        <span aria-hidden="true">üîÑ</span> DEFEND AGAIN
	    </button>
	</div>

	<!-- Login Required Alert -->
	<div class="game-over-alert" id="loginAlert" role="alertdialog" aria-labelledby="loginAlertTitle">
		<div style="font-size: 4rem;" aria-hidden="true">üîí</div>
		<h2 id="loginAlertTitle" style="font-size: 1.5rem;">AUTHENTICATION REQUIRED</h2>
		<p style="opacity: 0.85; margin: 1.5rem 0; font-size: 1rem; line-height: 1.5;">
			Sign in with your Google account to:<br>
			<strong style="color: var(--clr-neon-cyan);">‚úì</strong> Save your high scores<br>
			<strong style="color: var(--clr-neon-cyan);">‚úì</strong> Compete on global leaderboards<br>
			<strong style="color: var(--clr-neon-cyan);">‚úì</strong> Track your progress
		</p>
		<button class="arcade-btn" onclick="closeLoginAlert(); loginWithGoogle();" style="margin-top: 1rem;">
			<span aria-hidden="true">‚≠ê</span> SIGN IN WITH GOOGLE <span aria-hidden="true">‚≠ê</span>
		</button>
		<button class="arcade-btn" onclick="closeLoginAlert()" style="margin-top: 0.5rem; background: rgba(255,255,255,0.1); border-color: rgba(255,255,255,0.3);">
			<span aria-hidden="true">‚Üê</span> MAYBE LATER
		</button>
	</div>

	<!-- Change Nickname Modal -->
	<div class="modal" id="nicknameModal" role="dialog" aria-labelledby="nicknameModalTitle" aria-modal="true">
	    <div class="modal-content" style="max-inline-size: min(500px, 92vw);">
	        <div class="modal-header">
	            <h2 class="modal-title" id="nicknameModalTitle"><span aria-hidden="true">‚úèÔ∏è</span> CHANGE NICKNAME</h2>
	            <button class="close-btn" onclick="closeNicknameModal()" aria-label="Close">√ó</button>
	        </div>

	        <div style="padding: var(--space-md);">
	            <p style="margin-block-end: var(--space-md); opacity: 0.9; text-align: center; line-height: 1.6;">
	                Choose a unique nickname for the leaderboards.<br>
	                <span style="color: var(--clr-neon-yellow); font-size: 0.9rem;">‚ö†Ô∏è Max 25 characters. Most symbols allowed!</span>
	            </p>

	            <div style="margin-block-end: var(--space-md);">
	                <label for="nicknameInput" style="display: block; margin-block-end: var(--space-xs); color: var(--clr-neon-cyan); font-weight: 600;">
	                    New Nickname:
	                </label>
	                <input 
	                    type="text" 
	                    id="nicknameInput" 
	                    class="arcade-input" 
	                    placeholder="Enter your nickname..." 
	                    maxlength="25"
	                    style="width: 100%;"
	                    aria-label="New nickname input"
	                >
	               
    <!-- ‚úÖ NUEVO: Panel de s√≠mbolos sugeridos -->
    <details style="margin-block-start: var(--space-sm); padding: var(--space-sm); background: rgba(0,0,0,0.3); border-radius: var(--radius-sm); border: 1px solid rgba(0,255,255,0.2);">
        <summary style="cursor: pointer; color: var(--clr-neon-cyan); font-size: 0.85rem; user-select: none;">
            ‚ú® Click for fancy symbols
        </summary>
        <div style="margin-block-start: var(--space-xs); font-size: 0.9rem; line-height: 1.8; opacity: 0.9; max-height: 400px; overflow-y: auto; padding-right: 0.5rem;">
    
    <!-- DECORADORES -->
    <div style="margin-block-end: 0.3rem;"><strong style="color: var(--clr-neon-cyan);">Decorators:</strong></div>
    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-block-end: 0.8rem;">
        <button onclick="insertSymbol('‡º∫')" class="symbol-btn">‡º∫</button>
        <button onclick="insertSymbol('‡ºª')" class="symbol-btn">‡ºª</button>
        <button onclick="insertSymbol('ÍßÅ')" class="symbol-btn">ÍßÅ</button>
        <button onclick="insertSymbol('ÍßÇ')" class="symbol-btn">ÍßÇ</button>
        <button onclick="insertSymbol('„Äê')" class="symbol-btn">„Äê</button>
        <button onclick="insertSymbol('„Äë')" class="symbol-btn">„Äë</button>
        <button onclick="insertSymbol('„Äå')" class="symbol-btn">„Äå</button>
        <button onclick="insertSymbol('„Äç')" class="symbol-btn">„Äç</button>
        <button onclick="insertSymbol('„Äé')" class="symbol-btn">„Äé</button>
        <button onclick="insertSymbol('„Äè')" class="symbol-btn">„Äè</button>
        <button onclick="insertSymbol('¬´')" class="symbol-btn">¬´</button>
        <button onclick="insertSymbol('¬ª')" class="symbol-btn">¬ª</button>
        <button onclick="insertSymbol('‚Äπ')" class="symbol-btn">‚Äπ</button>
        <button onclick="insertSymbol('‚Ä∫')" class="symbol-btn">‚Ä∫</button>
        <button onclick="insertSymbol('„Ää')" class="symbol-btn">„Ää</button>
        <button onclick="insertSymbol('„Äã')" class="symbol-btn">„Äã</button>
        <button onclick="insertSymbol('„Äà')" class="symbol-btn">„Äà</button>
        <button onclick="insertSymbol('„Äâ')" class="symbol-btn">„Äâ</button>
        <button onclick="insertSymbol('„Äñ')" class="symbol-btn">„Äñ</button>
        <button onclick="insertSymbol('„Äó')" class="symbol-btn">„Äó</button>
    </div>

    <!-- ESTRELLAS Y BRILLOS -->
    <div style="margin-block-end: 0.3rem;"><strong style="color: var(--clr-neon-yellow);">Stars & Sparkles:</strong></div>
    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-block-end: 0.8rem;">
        <button onclick="insertSymbol('‚òÖ')" class="symbol-btn">‚òÖ</button>
        <button onclick="insertSymbol('‚òÜ')" class="symbol-btn">‚òÜ</button>
        <button onclick="insertSymbol('‚ú¶')" class="symbol-btn">‚ú¶</button>
        <button onclick="insertSymbol('‚úß')" class="symbol-btn">‚úß</button>
        <button onclick="insertSymbol('‚ú©')" class="symbol-btn">‚ú©</button>
        <button onclick="insertSymbol('‚ú™')" class="symbol-btn">‚ú™</button>
        <button onclick="insertSymbol('‚ú´')" class="symbol-btn">‚ú´</button>
        <button onclick="insertSymbol('‚ú¨')" class="symbol-btn">‚ú¨</button>
        <button onclick="insertSymbol('‚ú≠')" class="symbol-btn">‚ú≠</button>
        <button onclick="insertSymbol('‚úÆ')" class="symbol-btn">‚úÆ</button>
        <button onclick="insertSymbol('‚úØ')" class="symbol-btn">‚úØ</button>
        <button onclick="insertSymbol('‚ú∞')" class="symbol-btn">‚ú∞</button>
        <button onclick="insertSymbol('‚≠ê')" class="symbol-btn">‚≠ê</button>
        <button onclick="insertSymbol('üåü')" class="symbol-btn">üåü</button>
        <button onclick="insertSymbol('üí´')" class="symbol-btn">üí´</button>
        <button onclick="insertSymbol('‚ú®')" class="symbol-btn">‚ú®</button>
        <button onclick="insertSymbol('‚ö°')" class="symbol-btn">‚ö°</button>
        <button onclick="insertSymbol('‚òÑ')" class="symbol-btn">‚òÑ</button>
    </div>

    <!-- PUNTOS Y C√çRCULOS -->
    <div style="margin-block-end: 0.3rem;"><strong style="color: var(--clr-neon-pink);">Dots & Circles:</strong></div>
    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-block-end: 0.8rem;">
        <button onclick="insertSymbol('‚Ä¢')" class="symbol-btn">‚Ä¢</button>
        <button onclick="insertSymbol('‚óè')" class="symbol-btn">‚óè</button>
        <button onclick="insertSymbol('‚óã')" class="symbol-btn">‚óã</button>
        <button onclick="insertSymbol('‚óâ')" class="symbol-btn">‚óâ</button>
        <button onclick="insertSymbol('‚óå')" class="symbol-btn">‚óå</button>
        <button onclick="insertSymbol('‚óç')" class="symbol-btn">‚óç</button>
        <button onclick="insertSymbol('‚óé')" class="symbol-btn">‚óé</button>
        <button onclick="insertSymbol('‚óê')" class="symbol-btn">‚óê</button>
        <button onclick="insertSymbol('‚óë')" class="symbol-btn">‚óë</button>
        <button onclick="insertSymbol('‚óí')" class="symbol-btn">‚óí</button>
        <button onclick="insertSymbol('‚óì')" class="symbol-btn">‚óì</button>
        <button onclick="insertSymbol('‚óî')" class="symbol-btn">‚óî</button>
        <button onclick="insertSymbol('‚óï')" class="symbol-btn">‚óï</button>
        <button onclick="insertSymbol('‚óñ')" class="symbol-btn">‚óñ</button>
        <button onclick="insertSymbol('‚óó')" class="symbol-btn">‚óó</button>
        <button onclick="insertSymbol('‚ö´')" class="symbol-btn">‚ö´</button>
        <button onclick="insertSymbol('‚ö™')" class="symbol-btn">‚ö™</button>
        <button onclick="insertSymbol('üî¥')" class="symbol-btn">üî¥</button>
        <button onclick="insertSymbol('üîµ')" class="symbol-btn">üîµ</button>
    </div>

    <!-- FORMAS GEOM√âTRICAS -->
    <div style="margin-block-end: 0.3rem;"><strong style="color: var(--clr-neon-purple);">Geometric Shapes:</strong></div>
    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-block-end: 0.8rem;">
        <button onclick="insertSymbol('‚óÜ')" class="symbol-btn">‚óÜ</button>
        <button onclick="insertSymbol('‚óá')" class="symbol-btn">‚óá</button>
        <button onclick="insertSymbol('‚óà')" class="symbol-btn">‚óà</button>
        <button onclick="insertSymbol('‚óä')" class="symbol-btn">‚óä</button>
        <button onclick="insertSymbol('‚ô¶')" class="symbol-btn">‚ô¶</button>
        <button onclick="insertSymbol('‚ñ≤')" class="symbol-btn">‚ñ≤</button>
        <button onclick="insertSymbol('‚ñ≥')" class="symbol-btn">‚ñ≥</button>
        <button onclick="insertSymbol('‚ñº')" class="symbol-btn">‚ñº</button>
        <button onclick="insertSymbol('‚ñΩ')" class="symbol-btn">‚ñΩ</button>
        <button onclick="insertSymbol('‚ñ†')" class="symbol-btn">‚ñ†</button>
        <button onclick="insertSymbol('‚ñ°')" class="symbol-btn">‚ñ°</button>
        <button onclick="insertSymbol('‚ñ™')" class="symbol-btn">‚ñ™</button>
        <button onclick="insertSymbol('‚ñ´')" class="symbol-btn">‚ñ´</button>
        <button onclick="insertSymbol('‚óò')" class="symbol-btn">‚óò</button>
        <button onclick="insertSymbol('‚óô')" class="symbol-btn">‚óô</button>
        <button onclick="insertSymbol('‚óö')" class="symbol-btn">‚óö</button>
        <button onclick="insertSymbol('‚óõ')" class="symbol-btn">‚óõ</button>
        <button onclick="insertSymbol('‚óú')" class="symbol-btn">‚óú</button>
        <button onclick="insertSymbol('‚óù')" class="symbol-btn">‚óù</button>
        <button onclick="insertSymbol('‚óû')" class="symbol-btn">‚óû</button>
        <button onclick="insertSymbol('‚óü')" class="symbol-btn">‚óü</button>
    </div>

    <!-- S√çMBOLOS ESPECIALES -->
    <div style="margin-block-end: 0.3rem;"><strong style="color: var(--clr-neon-cyan);">Special Symbols:</strong></div>
    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-block-end: 0.8rem;">
        <button onclick="insertSymbol('‚ô∞')" class="symbol-btn">‚ô∞</button>
        <button onclick="insertSymbol('‚ò†')" class="symbol-btn">‚ò†</button>
        <button onclick="insertSymbol('“â')" class="symbol-btn">“â</button>
        <button onclick="insertSymbol('œü')" class="symbol-btn">œü</button>
        <button onclick="insertSymbol('Œ©')" class="symbol-btn">Œ©</button>
        <button onclick="insertSymbol('‚àû')" class="symbol-btn">‚àû</button>
        <button onclick="insertSymbol('‚Ä†')" class="symbol-btn">‚Ä†</button>
        <button onclick="insertSymbol('‚Ä°')" class="symbol-btn">‚Ä°</button>
        <button onclick="insertSymbol('¬ß')" class="symbol-btn">¬ß</button>
        <button onclick="insertSymbol('¬∂')" class="symbol-btn">¬∂</button>
        <button onclick="insertSymbol('‚Ñ¢')" class="symbol-btn">‚Ñ¢</button>
        <button onclick="insertSymbol('¬©')" class="symbol-btn">¬©</button>
        <button onclick="insertSymbol('¬Æ')" class="symbol-btn">¬Æ</button>
        <button onclick="insertSymbol('‚Ñó')" class="symbol-btn">‚Ñó</button>
        <button onclick="insertSymbol('‚Ñ†')" class="symbol-btn">‚Ñ†</button>
        <button onclick="insertSymbol('‚í∂')" class="symbol-btn">‚í∂</button>
        <button onclick="insertSymbol('‚ÑÉ')" class="symbol-btn">‚ÑÉ</button>
        <button onclick="insertSymbol('‚Ñâ')" class="symbol-btn">‚Ñâ</button>
        <button onclick="insertSymbol('‚Ññ')" class="symbol-btn">‚Ññ</button>
        <button onclick="insertSymbol('‚ÑÆ')" class="symbol-btn">‚ÑÆ</button>
    </div>

    <!-- FLECHAS -->
    <div style="margin-block-end: 0.3rem;"><strong style="color: var(--clr-neon-yellow);">Arrows:</strong></div>
    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-block-end: 0.8rem;">
        <button onclick="insertSymbol('‚Üí')" class="symbol-btn">‚Üí</button>
        <button onclick="insertSymbol('‚Üê')" class="symbol-btn">‚Üê</button>
        <button onclick="insertSymbol('‚Üë')" class="symbol-btn">‚Üë</button>
        <button onclick="insertSymbol('‚Üì')" class="symbol-btn">‚Üì</button>
        <button onclick="insertSymbol('‚Üî')" class="symbol-btn">‚Üî</button>
        <button onclick="insertSymbol('‚Üï')" class="symbol-btn">‚Üï</button>
        <button onclick="insertSymbol('‚áí')" class="symbol-btn">‚áí</button>
        <button onclick="insertSymbol('‚áê')" class="symbol-btn">‚áê</button>
        <button onclick="insertSymbol('‚áë')" class="symbol-btn">‚áë</button>
        <button onclick="insertSymbol('‚áì')" class="symbol-btn">‚áì</button>
        <button onclick="insertSymbol('‚áî')" class="symbol-btn">‚áî</button>
        <button onclick="insertSymbol('‚ûî')" class="symbol-btn">‚ûî</button>
        <button onclick="insertSymbol('‚ûú')" class="symbol-btn">‚ûú</button>
        <button onclick="insertSymbol('‚ûô')" class="symbol-btn">‚ûô</button>
        <button onclick="insertSymbol('‚ûõ')" class="symbol-btn">‚ûõ</button>
        <button onclick="insertSymbol('‚ûù')" class="symbol-btn">‚ûù</button>
        <button onclick="insertSymbol('‚ü∂')" class="symbol-btn">‚ü∂</button>
        <button onclick="insertSymbol('‚üπ')" class="symbol-btn">‚üπ</button>
    </div>

    <!-- CARACTERES JAPONESES/ASI√ÅTICOS -->
    <div style="margin-block-end: 0.3rem;"><strong style="color: var(--clr-neon-pink);">Japanese/Asian:</strong></div>
    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-block-end: 0.8rem;">
        <button onclick="insertSymbol('„ÉÑ')" class="symbol-btn">„ÉÑ</button>
        <button onclick="insertSymbol('„ÉÉ')" class="symbol-btn">„ÉÉ</button>
        <button onclick="insertSymbol('„Ç∑')" class="symbol-btn">„Ç∑</button>
        <button onclick="insertSymbol('„Ñú')" class="symbol-btn">„Ñú</button>
        <button onclick="insertSymbol('„Öé')" class="symbol-btn">„Öé</button>
        <button onclick="insertSymbol('„Ñ±')" class="symbol-btn">„Ñ±</button>
        <button onclick="insertSymbol('„Öã')" class="symbol-btn">„Öã</button>
        <button onclick="insertSymbol('„ÖÖ')" class="symbol-btn">„ÖÖ</button>
        <button onclick="insertSymbol('Èæç')" class="symbol-btn">Èæç</button>
        <button onclick="insertSymbol('È¨º')" class="symbol-btn">È¨º</button>
        <button onclick="insertSymbol('ÂΩ±')" class="symbol-btn">ÂΩ±</button>
        <button onclick="insertSymbol('Èóá')" class="symbol-btn">Èóá</button>
        <button onclick="insertSymbol('Â§ú')" class="symbol-btn">Â§ú</button>
        <button onclick="insertSymbol('Ê≠ª')" class="symbol-btn">Ê≠ª</button>
        <button onclick="insertSymbol('È≠Ç')" class="symbol-btn">È≠Ç</button>
        <button onclick="insertSymbol('Áéã')" class="symbol-btn">Áéã</button>
    </div>

    <!-- CORONAS Y S√çMBOLOS REALES -->
    <div style="margin-block-end: 0.3rem;"><strong style="color: var(--clr-neon-purple);">Crowns & Royal:</strong></div>
    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-block-end: 0.8rem;">
        <button onclick="insertSymbol('‚ôî')" class="symbol-btn">‚ôî</button>
        <button onclick="insertSymbol('‚ôï')" class="symbol-btn">‚ôï</button>
        <button onclick="insertSymbol('‚ôñ')" class="symbol-btn">‚ôñ</button>
        <button onclick="insertSymbol('‚ôó')" class="symbol-btn">‚ôó</button>
        <button onclick="insertSymbol('‚ôò')" class="symbol-btn">‚ôò</button>
        <button onclick="insertSymbol('‚ôô')" class="symbol-btn">‚ôô</button>
        <button onclick="insertSymbol('‚ôö')" class="symbol-btn">‚ôö</button>
        <button onclick="insertSymbol('‚ôõ')" class="symbol-btn">‚ôõ</button>
        <button onclick="insertSymbol('‚ôú')" class="symbol-btn">‚ôú</button>
        <button onclick="insertSymbol('‚ôù')" class="symbol-btn">‚ôù</button>
        <button onclick="insertSymbol('‚ôû')" class="symbol-btn">‚ôû</button>
        <button onclick="insertSymbol('‚ôü')" class="symbol-btn">‚ôü</button>
        <button onclick="insertSymbol('üëë')" class="symbol-btn">üëë</button>
        <button onclick="insertSymbol('üíé')" class="symbol-btn">üíé</button>
        <button onclick="insertSymbol('üèÜ')" class="symbol-btn">üèÜ</button>
        <button onclick="insertSymbol('‚öî')" class="symbol-btn">‚öî</button>
    </div>

    <!-- CORAZONES Y S√çMBOLOS DE CARTAS -->
    <div style="margin-block-end: 0.3rem;"><strong style="color: var(--clr-neon-cyan);">Hearts & Cards:</strong></div>
    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-block-end: 0.8rem;">
        <button onclick="insertSymbol('‚ô•')" class="symbol-btn">‚ô•</button>
        <button onclick="insertSymbol('‚ô°')" class="symbol-btn">‚ô°</button>
        <button onclick="insertSymbol('‚ù§')" class="symbol-btn">‚ù§</button>
        <button onclick="insertSymbol('‚ù•')" class="symbol-btn">‚ù•</button>
        <button onclick="insertSymbol('‚ô†')" class="symbol-btn">‚ô†</button>
        <button onclick="insertSymbol('‚ô£')" class="symbol-btn">‚ô£</button>
        <button onclick="insertSymbol('‚ô¶')" class="symbol-btn">‚ô¶</button>
        <button onclick="insertSymbol('üñ§')" class="symbol-btn">üñ§</button>
        <button onclick="insertSymbol('üíú')" class="symbol-btn">üíú</button>
        <button onclick="insertSymbol('üíô')" class="symbol-btn">üíô</button>
        <button onclick="insertSymbol('üíö')" class="symbol-btn">üíö</button>
        <button onclick="insertSymbol('üíõ')" class="symbol-btn">üíõ</button>
        <button onclick="insertSymbol('üß°')" class="symbol-btn">üß°</button>
    </div>

    <!-- M√öSICA -->
    <div style="margin-block-end: 0.3rem;"><strong style="color: var(--clr-neon-yellow);">Music:</strong></div>
    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-block-end: 0.8rem;">
        <button onclick="insertSymbol('‚ô™')" class="symbol-btn">‚ô™</button>
        <button onclick="insertSymbol('‚ô´')" class="symbol-btn">‚ô´</button>
        <button onclick="insertSymbol('‚ô¨')" class="symbol-btn">‚ô¨</button>
        <button onclick="insertSymbol('‚ô≠')" class="symbol-btn">‚ô≠</button>
        <button onclick="insertSymbol('‚ôÆ')" class="symbol-btn">‚ôÆ</button>
        <button onclick="insertSymbol('‚ôØ')" class="symbol-btn">‚ôØ</button>
        <button onclick="insertSymbol('üéµ')" class="symbol-btn">üéµ</button>
        <button onclick="insertSymbol('üé∂')" class="symbol-btn">üé∂</button>
        <button onclick="insertSymbol('üé∏')" class="symbol-btn">üé∏</button>
        <button onclick="insertSymbol('üéπ')" class="symbol-btn">üéπ</button>
        <button onclick="insertSymbol('üé§')" class="symbol-btn">üé§</button>
        <button onclick="insertSymbol('üéß')" class="symbol-btn">üéß</button>
    </div>

    <!-- SIGNOS ZODIACALES -->
    <div style="margin-block-end: 0.3rem;"><strong style="color: var(--clr-neon-pink);">Zodiac:</strong></div>
    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-block-end: 0.8rem;">
        <button onclick="insertSymbol('‚ôà')" class="symbol-btn">‚ôà</button>
        <button onclick="insertSymbol('‚ôâ')" class="symbol-btn">‚ôâ</button>
        <button onclick="insertSymbol('‚ôä')" class="symbol-btn">‚ôä</button>
        <button onclick="insertSymbol('‚ôã')" class="symbol-btn">‚ôã</button>
        <button onclick="insertSymbol('‚ôå')" class="symbol-btn">‚ôå</button>
        <button onclick="insertSymbol('‚ôç')" class="symbol-btn">‚ôç</button>
        <button onclick="insertSymbol('‚ôé')" class="symbol-btn">‚ôé</button>
        <button onclick="insertSymbol('‚ôè')" class="symbol-btn">‚ôè</button>
        <button onclick="insertSymbol('‚ôê')" class="symbol-btn">‚ôê</button>
        <button onclick="insertSymbol('‚ôë')" class="symbol-btn">‚ôë</button>
        <button onclick="insertSymbol('‚ôí')" class="symbol-btn">‚ôí</button>
        <button onclick="insertSymbol('‚ôì')" class="symbol-btn">‚ôì</button>
    </div>

    <!-- WEATHER & NATURE -->
    <div style="margin-block-end: 0.3rem;"><strong style="color: var(--clr-neon-purple);">Weather & Nature:</strong></div>
    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-block-end: 0.8rem;">
        <button onclick="insertSymbol('‚òÄ')" class="symbol-btn">‚òÄ</button>
        <button onclick="insertSymbol('‚òÅ')" class="symbol-btn">‚òÅ</button>
        <button onclick="insertSymbol('‚òÇ')" class="symbol-btn">‚òÇ</button>
        <button onclick="insertSymbol('‚òÉ')" class="symbol-btn">‚òÉ</button>
        <button onclick="insertSymbol('‚òÑ')" class="symbol-btn">‚òÑ</button>
        <button onclick="insertSymbol('‚òÖ')" class="symbol-btn">‚òÜ</button>
        <button onclick="insertSymbol('‚òº')" class="symbol-btn">‚òº</button>
        <button onclick="insertSymbol('‚òΩ')" class="symbol-btn">‚òΩ</button>
        <button onclick="insertSymbol('‚òæ')" class="symbol-btn">‚òæ</button>
        <button onclick="insertSymbol('üåô')" class="symbol-btn">üåô</button>
        <button onclick="insertSymbol('üåü')" class="symbol-btn">üåü</button>
        <button onclick="insertSymbol('üå†')" class="symbol-btn">üå†</button>
        <button onclick="insertSymbol('üî•')" class="symbol-btn">üî•</button>
        <button onclick="insertSymbol('üíß')" class="symbol-btn">üíß</button>
        <button onclick="insertSymbol('‚ö°')" class="symbol-btn">‚ö°</button>
        <button onclick="insertSymbol('‚ùÑ')" class="symbol-btn">‚ùÑ</button>
    </div>

    <!-- GAMING -->
    <div style="margin-block-end: 0.3rem;"><strong style="color: var(--clr-neon-cyan);">Gaming:</strong></div>
    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-block-end: 0.8rem;">
        <button onclick="insertSymbol('üéÆ')" class="symbol-btn">üéÆ</button>
        <button onclick="insertSymbol('üïπ')" class="symbol-btn">üïπ</button>
        <button onclick="insertSymbol('üëæ')" class="symbol-btn">üëæ</button>
        <button onclick="insertSymbol('üéØ')" class="symbol-btn">üéØ</button>
        <button onclick="insertSymbol('üé≤')" class="symbol-btn">üé≤</button>
        <button onclick="insertSymbol('üÉè')" class="symbol-btn">üÉè</button>
        <button onclick="insertSymbol('üé∞')" class="symbol-btn">üé∞</button>
        <button onclick="insertSymbol('üèÜ')" class="symbol-btn">üèÜ</button>
        <button onclick="insertSymbol('ü•á')" class="symbol-btn">ü•á</button>
        <button onclick="insertSymbol('ü•à')" class="symbol-btn">ü•à</button>
        <button onclick="insertSymbol('ü•â')" class="symbol-btn">ü•â</button>
        <button onclick="insertSymbol('üèÖ')" class="symbol-btn">üèÖ</button>
        <button onclick="insertSymbol('üéñ')" class="symbol-btn">üéñ</button>
    </div>

    <!-- EMOJIS OSCUROS -->
    <div style="margin-block-end: 0.3rem;"><strong style="color: var(--clr-neon-yellow);">Dark & Cool:</strong></div>
    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-block-end: 0.8rem;">
        <button onclick="insertSymbol('üíÄ')" class="symbol-btn">üíÄ</button>
        <button onclick="insertSymbol('‚ò†')" class="symbol-btn">‚ò†</button>
        <button onclick="insertSymbol('üëª')" class="symbol-btn">üëª</button>
        <button onclick="insertSymbol('üëπ')" class="symbol-btn">üëπ</button>
        <button onclick="insertSymbol('üë∫')" class="symbol-btn">üë∫</button>
        <button onclick="insertSymbol('üòà')" class="symbol-btn">üòà</button>
        <button onclick="insertSymbol('üëø')" class="symbol-btn">üëø</button>
        <button onclick="insertSymbol('ü¶á')" class="symbol-btn">ü¶á</button>
        <button onclick="insertSymbol('üï∑')" class="symbol-btn">üï∑</button>
        <button onclick="insertSymbol('üêâ')" class="symbol-btn">üêâ</button>
        <button onclick="insertSymbol('üê≤')" class="symbol-btn">üê≤</button>
        <button onclick="insertSymbol('üó°')" class="symbol-btn">üó°</button>
        <button onclick="insertSymbol('‚öî')" class="symbol-btn">‚öî</button>
        <button onclick="insertSymbol('üõ°')" class="symbol-btn">üõ°</button>
    </div>

    <!-- LETRAS ESPECIALES -->
    <div style="margin-block-end: 0.3rem;"><strong style="color: var(--clr-neon-pink);">Special Letters:</strong></div>
    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-block-end: 0.8rem;">
        <button onclick="insertSymbol('‚í∂')" class="symbol-btn">‚í∂</button>
        <button onclick="insertSymbol('‚í∑')" class="symbol-btn">‚í∑</button>
        <button onclick="insertSymbol('‚í∏')" class="symbol-btn">‚í∏</button>
        <button onclick="insertSymbol('‚íπ')" class="symbol-btn">‚íπ</button>
        <button onclick="insertSymbol('‚í∫')" class="symbol-btn">‚í∫</button>
        <button onclick="insertSymbol('‚íª')" class="symbol-btn">‚íª</button>
        <button onclick="insertSymbol('‚íº')" class="symbol-btn">‚íº</button>
        <button onclick="insertSymbol('‚íΩ')" class="symbol-btn">‚íΩ</button>
        <button onclick="insertSymbol('‚íæ')" class="symbol-btn">‚íæ</button>
        <button onclick="insertSymbol('‚íø')" class="symbol-btn">‚íø</button>
        <button onclick="insertSymbol('‚ìÄ')" class="symbol-btn">‚ìÄ</button>
        <button onclick="insertSymbol('‚ìÅ')" class="symbol-btn">‚ìÅ</button>
        <button onclick="insertSymbol('‚ìÇ')" class="symbol-btn">‚ìÇ</button>
        <button onclick="insertSymbol('‚ìÉ')" class="symbol-btn">‚ìÉ</button>
        <button onclick="insertSymbol('‚ìÑ')" class="symbol-btn">‚ìÑ</button>
        <button onclick="insertSymbol('‚ìÖ')" class="symbol-btn">‚ìÖ</button>
        <button onclick="insertSymbol('‚ìÜ')" class="symbol-btn">‚ìÜ</button>
        <button onclick="insertSymbol('‚ìá')" class="symbol-btn">‚ìá</button>
        <button onclick="insertSymbol('‚ìà')" class="symbol-btn">‚ìà</button>
        <button onclick="insertSymbol('‚ìâ')" class="symbol-btn">‚ìâ</button>
        <button onclick="insertSymbol('‚ìä')" class="symbol-btn">‚ìä</button>
        <button onclick="insertSymbol('‚ìã')" class="symbol-btn">‚ìã</button>
        <button onclick="insertSymbol('‚ìå')" class="symbol-btn">‚ìå</button>
        <button onclick="insertSymbol('‚ìç')" class="symbol-btn">‚ìç</button>
        <button onclick="insertSymbol('‚ìé')" class="symbol-btn">‚ìé</button>
        <button onclick="insertSymbol('‚ìè')" class="symbol-btn">‚ìè</button>
     </div>

</div>
    </details>
    
    <div id="nicknameError" style="color: var(--clr-neon-pink); margin-block-start: var(--space-xs); font-size: 0.85rem; min-height: 1.5rem;">
        <!-- Error messages here -->
    </div>
</div>
	                <div id="nicknameError" style="color: var(--clr-neon-pink); margin-block-start: var(--space-xs); font-size: 0.85rem; min-height: 1.5rem;">
	                    <!-- Error messages here -->
	                </div>
	            </div>

	            <div style="display: flex; gap: var(--space-sm); justify-content: center; flex-wrap: wrap;">
	                <button class="arcade-btn" onclick="saveNickname()" id="saveNicknameBtn">
	                    <span aria-hidden="true">üíæ</span> SAVE NICKNAME
	                </button>
	                <button class="arcade-btn" onclick="closeNicknameModal()" style="background: rgba(255,255,255,0.1); border-color: rgba(255,255,255,0.3);">
	                    <span aria-hidden="true">‚úñÔ∏è</span> CANCEL
	                </button>
	            </div>

	            <div style="margin-block-start: var(--space-lg); padding: var(--space-sm); background: rgba(0,0,0,0.3); border-radius: var(--radius-md); font-size: 0.85rem; opacity: 0.8;">
	                <strong style="color: var(--clr-neon-cyan);">‚ÑπÔ∏è Note:</strong> Your nickname will be updated across all leaderboards. Changes may take a few moments to reflect.
	            </div>
	        </div>
	    </div>
	</div>
</body>

	<script>
		// Initialize stars
		document.addEventListener('DOMContentLoaded', () => {
		    initAuth();
		    initializeStars();
		});

		function initializeStars() {
		    const starsContainer = document.getElementById('starsContainer');
		    const fragment = document.createDocumentFragment(); // ‚úÖ Mejor rendimiento
		    
		    for (let i = 0; i < 100; i++) {
		        const star = document.createElement('div');
		        star.className = 'star';
		        star.style.left = `${Math.random() * 100}%`;
		        star.style.top = `${Math.random() * 100}%`;
		        star.style.animationDelay = `${Math.random() * 3}s`;
		        fragment.appendChild(star);
		    }
		    
		    starsContainer.appendChild(fragment);
		}

		// ===== A√ëADE ESTO: INICIALIZACI√ìN DE FIREBASE =====

	    // Pega aqu√≠ tu objeto de configuraci√≥n que copiaste
		const firebaseConfig = {
			apiKey: "AIzaSyDipUw7d4av0JwfudVDdECNjZXdjy3OGyw",
			authDomain: "juego-arcade-scores.firebaseapp.com",
			projectId: "juego-arcade-scores",
			storageBucket: "juego-arcade-scores.firebasestorage.app",
			messagingSenderId: "33838418828",
			appId: "1:33838418828:web:5aa1579a7f645992c2a4a9",
			measurementId: "G-47JPGCPBM0"
		};

	    // Inicializa Firebase y Firestore
		firebase.initializeApp(firebaseConfig);
		const db = firebase.firestore();

	    // ===== FIN DE LA INICIALIZACI√ìN DE FIREBASE =====

// ===== USER MANAGEMENT & FIRESTORE LOGIC =====
// 1. Define la variable 'auth'
		const auth = firebase.auth();
		let currentUser = null; // Esto ahora ser√° un objeto de Firebase, no un string

		// 2. Nueva funci√≥n: Iniciar sesi√≥n con Google
		async function loginWithGoogle() {
		    try {
		        const loginBtn = document.querySelector('#loginView .arcade-btn');
		        loginBtn.disabled = true;
		        loginBtn.textContent = '‚è≥ SIGNING IN...';
		        
		        const provider = new firebase.auth.GoogleAuthProvider();
		        await auth.signInWithPopup(provider);
		        
		    } catch (error) {
		        console.error("Error al iniciar sesi√≥n con Google:", error);
		        
		        let errorMessage = "There was an error signing in.";
		        if (error.code === 'auth/popup-closed-by-user') {
		            errorMessage = "Sign-in cancelled. Please try again.";
		        } else if (error.code === 'auth/popup-blocked') {
		            errorMessage = "Pop-up blocked! Please allow pop-ups for this site.";
		        }
		        
		        alert(errorMessage);
		    }
		}

		async function logout() {
		    try {
		        const logoutBtn = document.querySelector('#userView .arcade-btn:last-child');
		        logoutBtn.disabled = true;
		        logoutBtn.textContent = '‚è≥ LOGGING OUT...';
		        
		        await auth.signOut();
		    
		    } catch (error) {
		        console.error("Error al cerrar sesi√≥n:", error);
		        alert("There was an error logging out. Please try again.");
		    }
		}

		// ===== NICKNAME SYSTEM =====
let userNickname = null;

// Cargar o crear nickname del usuario
async function loadUserNickname(user) {
    if (!user || !user.uid || !isStorageAvailable()) return user.displayName;
    
    try {
        const userDoc = await db.collection('users').doc(user.uid).get();
        
        if (userDoc.exists && userDoc.data().nickname) {
            userNickname = userDoc.data().nickname;
            console.log('‚úÖ Nickname cargado:', userNickname);
        } else {
            // Primera vez: usar nombre de Google
            userNickname = user.displayName;
            await db.collection('users').doc(user.uid).set({
                nickname: userNickname,
                googleName: user.displayName,
                email: user.email,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            console.log('‚úÖ Primer login: nickname creado con nombre de Google');
        }
        
        return userNickname;
    } catch (error) {
        console.error('Error al cargar nickname:', error);
        return user.displayName;
    }
}

// Obtener el nickname actual del usuario
function getUserDisplayName() {
    if (!currentUser) return 'Guest';
    return userNickname || currentUser.displayName;
}

// Abrir modal de cambio de nickname
function openChangeNickname() {
    if (!currentUser) return;
    
    document.getElementById('nicknameModal').classList.add('active');
    document.getElementById('nicknameInput').value = userNickname || '';
    document.getElementById('nicknameError').textContent = '';
    document.getElementById('nicknameInput').focus();
}

// Insertar s√≠mbolo en el input
function insertSymbol(symbol) {
    const input = document.getElementById('nicknameInput');
    const cursorPos = input.selectionStart;
    const textBefore = input.value.substring(0, cursorPos);
    const textAfter = input.value.substring(cursorPos);
    
    input.value = textBefore + symbol + textAfter;
    
    // Mover cursor despu√©s del s√≠mbolo insertado
    const newPos = cursorPos + symbol.length;
    input.setSelectionRange(newPos, newPos);
    input.focus();
}

// Cerrar modal
function closeNicknameModal() {
    document.getElementById('nicknameModal').classList.remove('active');
    document.getElementById('nicknameInput').value = '';
    document.getElementById('nicknameError').textContent = '';
}

// Validar nickname
// Validar nickname (versi√≥n permisiva con s√≠mbolos especiales)
function validateNickname(nickname) {
    if (!nickname || nickname.trim().length === 0) {
        return { valid: false, error: '‚ùå Nickname cannot be empty' };
    }
    
    // Contar caracteres reales (algunos s√≠mbolos especiales cuentan como m√∫ltiples)
    const realLength = [...nickname].length;
    
    if (realLength < 3) {
        return { valid: false, error: '‚ùå Nickname must be at least 3 characters' };
    }
    
    if (realLength > 25) { // Aumentado de 20 a 25 para dar m√°s espacio
        return { valid: false, error: '‚ùå Nickname must be 25 characters or less' };
    }
    
    // Bloquear solo caracteres realmente problem√°ticos
    const forbiddenChars = ['<', '>', '{', '}', '[', ']', '\\', '/', '|', '`'];
    for (const char of forbiddenChars) {
        if (nickname.includes(char)) {
            return { valid: false, error: `‚ùå Character "${char}" is not allowed` };
        }
    }
    
    // Verificar que no sea solo espacios o s√≠mbolos vac√≠os
    if (nickname.trim().replace(/[^\w]/g, '').length === 0 && !(/\p{Emoji}/u.test(nickname))) {
        return { valid: false, error: '‚ùå Nickname must contain at least some letters or numbers' };
    }
    
    return { valid: true };
}

// Guardar nuevo nickname
async function saveNickname() {
    if (!currentUser || !currentUser.uid || !isStorageAvailable()) return;
    
    const nicknameInput = document.getElementById('nicknameInput');
    const errorDiv = document.getElementById('nicknameError');
    const saveBtn = document.getElementById('saveNicknameBtn');
    
    const newNickname = nicknameInput.value.trim();
    
    // Validar
    const validation = validateNickname(newNickname);
    if (!validation.valid) {
        errorDiv.textContent = validation.error;
        return;
    }
    
    // Deshabilitar bot√≥n mientras guarda
    saveBtn.disabled = true;
    saveBtn.textContent = '‚è≥ SAVING...';
    errorDiv.textContent = '';
    
    try {
        const userId = currentUser.uid;
        
        // Actualizar en la colecci√≥n de usuarios
        await db.collection('users').doc(userId).set({
            nickname: newNickname,
            googleName: currentUser.displayName,
            email: currentUser.email,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        }, { merge: true });
        
        // Actualizar todos los scores con el nuevo nickname
        const collections = ['user_best_catch', 'user_best_memory', 'user_best_runner', 'user_best_invaders'];
        
        for (const collectionName of collections) {
            const docRef = db.collection(collectionName).doc(userId);
            const doc = await docRef.get();
            
            if (doc.exists) {
                await docRef.update({
                    username: newNickname
                });
            }
        }
        
        // Actualizar variable local
        userNickname = newNickname;
        
        // Actualizar UI
        document.getElementById('displayUsername').textContent = newNickname;
        
        // Recargar leaderboards
        await loadLeaderboards();
        
        console.log('‚úÖ Nickname actualizado exitosamente:', newNickname);
        
        // Mostrar √©xito
        errorDiv.style.color = 'var(--clr-neon-cyan)';
        errorDiv.textContent = '‚úÖ Nickname updated successfully!';
        
        setTimeout(() => {
            closeNicknameModal();
            saveBtn.disabled = false;
            saveBtn.innerHTML = '<span aria-hidden="true">üíæ</span> SAVE NICKNAME';
        }, 1500);
        
    } catch (error) {
        console.error('‚ùå Error al guardar nickname:', error);
        errorDiv.textContent = '‚ùå Error saving nickname. Please try again.';
        saveBtn.disabled = false;
        saveBtn.innerHTML = '<span aria-hidden="true">üíæ</span> SAVE NICKNAME';
    }
}

// Permitir guardar con Enter
document.addEventListener('DOMContentLoaded', () => {
    const nicknameInput = document.getElementById('nicknameInput');
    if (nicknameInput) {
        nicknameInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                saveNickname();
            }
        });
    }
});

        // 4. Nueva funci√≥n: El "Observador"
        // Esta funci√≥n se ejecuta CADA VEZ que el estado de login cambia
function initAuth() {
    auth.onAuthStateChanged(async (user) => {
        if (user) {
            console.log("Usuario conectado:", user.displayName, user.uid);
            currentUser = user;
            
            // ‚úÖ Cargar nickname personalizado
            const displayName = await loadUserNickname(user);
            
            document.getElementById('loginView').style.display = 'none';
            document.getElementById('userView').style.display = 'flex';
            document.getElementById('displayUsername').textContent = displayName;
            
            loadUserStats();
            loadLeaderboards();

        } else {
            console.log("User logged out.");
            currentUser = null;
            userNickname = null; // ‚úÖ Limpiar nickname

            document.getElementById('loginView').style.display = 'block';
            document.getElementById('userView').style.display = 'none';

            closeGame('catch');
            closeGame('memory');
            closeGame('runner');
            closeGame('invaders');

            document.getElementById('catchBestPreview').textContent = '-';
            document.getElementById('memoryBestPreview').textContent = '-';
            document.getElementById('runnerBestPreview').textContent = '-';
            document.getElementById('invadersBestPreview').textContent = '-';

            loadLeaderboards();
        }
    });
}

        // 5. Llama al observador cuando la p√°gina cargue
		document.addEventListener('DOMContentLoaded', initAuth);

		function isStorageAvailable() {
			// Esta funci√≥n ahora comprueba si 'db' (nuestra base de datos) existe.
			return typeof db !== 'undefined' && db !== null;
		}

		async function loadUserStats() {
		    if (!currentUser || !currentUser.uid || !isStorageAvailable()) return;
		    
		    try {
		        const docId = currentUser.uid;
		        
		        // Catch
		        const catchDoc = await db.collection('user_best_catch').doc(docId).get();
		        if (catchDoc.exists) {
		            document.getElementById('catchBestPreview').textContent = catchDoc.data().score;
		        }

		        // Memory
		        const memoryDoc = await db.collection('user_best_memory').doc(docId).get();
		        if (memoryDoc.exists) {
		            document.getElementById('memoryBestPreview').textContent = memoryDoc.data().score;
		        }
		        
		        // ‚úÖ RUNNER
		        const runnerDoc = await db.collection('user_best_runner').doc(docId).get();
		        if (runnerDoc.exists) {
		            document.getElementById('runnerBestPreview').textContent = runnerDoc.data().score;
		        }
		        
		        // ‚úÖ INVADERS
		        const invadersDoc = await db.collection('user_best_invaders').doc(docId).get();
		        if (invadersDoc.exists) {
		            document.getElementById('invadersBestPreview').textContent = invadersDoc.data().score;
		        }
		    } catch (error) {
		        console.error('Error loading user stats:', error);
		    }
		}

		// Evitar m√∫ltiples guardados simult√°neos
		let saveScoreTimeout = null;


async function saveScore(game, score) {
    if (!currentUser || !currentUser.uid || !isStorageAvailable()) {
        console.log('User not logged in or DB not available. Score not saved.');
        return;
    }
    
    // Cancelar guardado pendiente
    if (saveScoreTimeout) {
        clearTimeout(saveScoreTimeout);
    }
    
    // Esperar un momento antes de guardar (debounce)
    return new Promise((resolve) => {
        saveScoreTimeout = setTimeout(async () => {
            const isCatchGame = game === 'catch';
            const isMemoryGame = game === 'memory';
            
            // ‚úÖ Determinar nombre de colecci√≥n
            let collectionName;
            if (game === 'catch') collectionName = 'user_best_catch';
            else if (game === 'memory') collectionName = 'user_best_memory';
            else if (game === 'runner') collectionName = 'user_best_runner';
            else if (game === 'invaders') collectionName = 'user_best_invaders';
            else {
                console.error('Unknown game:', game);
                resolve();
                return;
            }
            
            const docId = currentUser.uid;
            const docRef = db.collection(collectionName).doc(docId);
            
            try {
                const doc = await docRef.get();
                let shouldSave = false;
                
                if (!doc.exists) {
                    console.log(`No previous score found for ${game}. Saving first score.`);
                    shouldSave = true;
                } else {
                    const existingScore = doc.data().score;
                    console.log(`Previous score for ${game}:`, existingScore, '| New score:', score);
                    
                    // Para Memory, menor es mejor
                    if (isMemoryGame) {
                        shouldSave = score < existingScore;
                    } else {
                        // Para otros juegos, mayor es mejor
                        shouldSave = score > existingScore;
                    }
                }
                
					if (shouldSave) {
					    console.log(`‚úÖ Saving new best score for ${game}: ${score}`);
					    await docRef.set({
					        username: getUserDisplayName(), // ‚úÖ Usar nickname personalizado
					        score: score,
					        timestamp: firebase.firestore.FieldValue.serverTimestamp()
					    });
					    
					    console.log(`‚úÖ Score saved successfully for ${game}`);
					    
					    await loadUserStats();
					    await loadLeaderboards();
                    
                } else {
                    console.log(`‚ÑπÔ∏è Score ${score} is not better than existing ${doc.data().score}. Not saving.`);
                }
                resolve();
            } catch (error) {
                console.error('‚ùå Error saving score:', error);
                console.error('Error details:', error.code, error.message);
                resolve();
            }
        }, 500);
    });
}

		async function loadLeaderboards() {
			if (!isStorageAvailable()) {
				document.getElementById('catchLeaderboard').innerHTML = '<li class="no-scores">Database not available</li>';
				document.getElementById('memoryLeaderboard').innerHTML = '<li class="no-scores">Database not available</li>';
				return;
			}
			await loadCatchLeaderboard();
			await loadMemoryLeaderboard();
			await loadRunnerLeaderboard(); // ‚úÖ NUEVO
    		await loadInvadersLeaderboard();
		}

		async function loadCatchLeaderboard() {
			if (!isStorageAvailable()) return;
			
			const leaderboardEl = document.getElementById('catchLeaderboard');
			leaderboardEl.innerHTML = '<li class="no-scores">Loading...</li>';

			try {
                // Pedir a Firestore los 10 mejores, ordenados por 'score' descendente
				const snapshot = await db.collection('user_best_catch')
				.orderBy('score', 'desc')
				.limit(10)
				.get();

				if (snapshot.empty) {
					leaderboardEl.innerHTML = '<li class="no-scores">No scores yet. Be the first!</li>';
					document.getElementById('catchWorldPreview').textContent = '-';
					return;
				}

				const sortedScores = snapshot.docs.map(doc => doc.data());

                // Actualizar el "World Record"
				document.getElementById('catchWorldPreview').textContent = sortedScores[0].score;

				leaderboardEl.innerHTML = sortedScores.map((score, index) => {
					const rankClass = index === 0 ? 'top-1' : index === 1 ? 'top-2' : index === 2 ? 'top-3' : '';
					const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}.`;
					return `
						<li class="leaderboard-item ${rankClass}">
							<span class="leaderboard-rank">${medal}</span>
							<span class="leaderboard-name">${score.username}</span>
							<span class="leaderboard-score">${score.score}</span>
						</li>
					`;
				}).join('');
			} catch (error) {
				console.error('Error loading catch leaderboard:', error);
				leaderboardEl.innerHTML = '<li class="no-scores">Error loading scores</li>';
			}
		}

		async function loadMemoryLeaderboard() {
			if (!isStorageAvailable()) return;

			const leaderboardEl = document.getElementById('memoryLeaderboard');
			leaderboardEl.innerHTML = '<li class="no-scores">Loading...</li>';

			try {
                // Pedir a Firestore los 10 mejores, ordenados por 'score' ascendente (menos movimientos es mejor)
				const snapshot = await db.collection('user_best_memory')
				.orderBy('score', 'asc')
				.limit(10)
				.get();

				if (snapshot.empty) {
					leaderboardEl.innerHTML = '<li class="no-scores">No scores yet. Be the first!</li>';
					document.getElementById('memoryWorldPreview').textContent = '-';
					return;
				}

				const sortedScores = snapshot.docs.map(doc => doc.data());

                // Actualizar el "World Record"
				document.getElementById('memoryWorldPreview').textContent = sortedScores[0].score;

				leaderboardEl.innerHTML = sortedScores.map((score, index) => {
					const rankClass = index === 0 ? 'top-1' : index === 1 ? 'top-2' : index === 2 ? 'top-3' : '';
					const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}.`;
					return `
						<li class="leaderboard-item ${rankClass}">
							<span class="leaderboard-rank">${medal}</span>
							<span class="leaderboard-name">${score.username}</span>
							<span class="leaderboard-score">${score.score}</span>
						</li>
					`;
				}).join('');
			} catch (error)
			{
				console.error('Error loading memory leaderboard:', error);
				leaderboardEl.innerHTML = '<li class="no-scores">Error loading scores</li>';
			}
		}

		// ===== MODAL MANAGEMENT =====
		function openGame(game) {
		    if (!currentUser) {
		        document.getElementById('loginAlert').classList.add('active');
		        return;
		    }

		    if (game === 'catch') {
		        document.getElementById('catchModal').classList.add('active');
		    } else if (game === 'memory') {
		        document.getElementById('memoryModal').classList.add('active');
		        initMemoryGame();
		    } else if (game === 'runner') { // ‚úÖ NUEVO
		        document.getElementById('runnerModal').classList.add('active');
		    } else if (game === 'invaders') { // ‚úÖ NUEVO
		        document.getElementById('invadersModal').classList.add('active');
		    }
		}

		function closeGame(game) {
		    if (game === 'catch') {
		        stopCatchGame();
		        document.getElementById('catchModal').classList.remove('active');
		    } else if (game === 'memory') {
		        document.getElementById('memoryModal').classList.remove('active');
		    } else if (game === 'runner') { // ‚úÖ NUEVO
		        stopRunnerGame();
		        document.getElementById('runnerModal').classList.remove('active');
		    } else if (game === 'invaders') { // ‚úÖ NUEVO
		        stopInvadersGame();
		        document.getElementById('invadersModal').classList.remove('active');
		    }
		}

		// Funci√≥n para cerrar la alerta de login
		function closeLoginAlert() {
			document.getElementById('loginAlert').classList.remove('active');
		}

		// Funci√≥n para cerrar la victoria de Memory
		function closeMemoryVictory() {
			document.getElementById('memoryVictoryAlert').classList.remove('active');
			initMemoryGame(); // Reinicia autom√°ticamente
		}

		// ===== CATCH GAME =====
		let catchGameActive = false;
		let catchScore = 0;
		let catchTime = 30;
		let catchMultiplier = 1;
		let catchInterval;
		let catchTimer;
		let itemCheckIntervals = [];
		let hasShield = false;
		let catcherSpeed = 1;
		let targetCatcherX = 0;
		let catcherAnimFrame;
		let catcherEl; // Para guardar el elemento
		let gameAreaRect; // Para guardar las dimensiones

		function startCatchGame() {
			if (catchGameActive || !currentUser) return;
			
			document.getElementById('gameOverAlert').classList.remove('active');
			
			catchGameActive = true;
			catchScore = 0;
			catchTime = 30;
			catchMultiplier = 1;
			hasShield = false;
			catcherSpeed = 1;
			
			document.getElementById('catchScore').textContent = catchScore;
			document.getElementById('catchTime').textContent = catchTime;
			document.getElementById('catchMultiplier').textContent = 'x' + catchMultiplier;
			document.getElementById('catcher').style.filter = 'drop-shadow(0 0 10px rgba(255, 190, 11, 0.8))';
			
			document.querySelectorAll('.falling-item').forEach(item => item.remove());
			
			document.getElementById('catchStartBtn').disabled = true;
			
			catchInterval = setInterval(createFallingItem, 700);
			catchTimer = setInterval(() => {
				catchTime--;
				document.getElementById('catchTime').textContent = catchTime;
				if (catchTime <= 0) {
					stopCatchGame();
					showGameOverAlert();
				}
			}, 1000);
		}

		function stopCatchGame() {
			catchGameActive = false;
			clearInterval(catchInterval);
			clearInterval(catchTimer);
			
			itemCheckIntervals.forEach(interval => clearInterval(interval));
			itemCheckIntervals = [];
			
			document.querySelectorAll('.falling-item').forEach(item => item.remove());
			
			document.getElementById('catchStartBtn').disabled = false;
		}

		function createFallingItem() {
		    if (!catchGameActive) return;
		    
		    const item = document.createElement('div');
		    item.className = 'falling-item';
			
			const rand = Math.random();
			let itemType;
			
			if (rand < 0.15) {
				itemType = 'bomb';
				item.textContent = 'üí£';
			} else if (rand < 0.25) {
				// Power-ups
				const powerups = ['‚ö°', 'üåü', '‚è∞', 'üõ°Ô∏è'];
				const powerup = powerups[Math.floor(Math.random() * powerups.length)];
				item.textContent = powerup;
				itemType = 'powerup';
				item.dataset.powerup = powerup;
				item.classList.add('powerup');
			} else {
				itemType = 'star';
				item.textContent = '‚≠ê';
			}
			
			item.dataset.type = itemType;
			
			const gameWidth = document.getElementById('catchGameArea').offsetWidth;
			item.style.left = Math.random() * (gameWidth - 60) + 'px';
			item.style.top = '-80px'; // M√°s arriba para dar m√°s espacio

			const baseDuration = Math.random() * 1.5 + 4; // Duraci√≥n m√°s larga y menos aleatoria
			const duration = baseDuration / catcherSpeed;
			item.style.animation = `fall ${duration}s linear`;
			
			document.getElementById('catchGameArea').appendChild(item);
			
			let hasCollided = false;
    		let animationFrameId;
			
			const checkCollision = () => {
		        if (!catchGameActive || !item.parentElement || hasCollided) {
		            cancelAnimationFrame(animationFrameId);
		            return;
		        }
		        
		        const itemRect = item.getBoundingClientRect();
		        const catcherRect = document.getElementById('catcher').getBoundingClientRect();
		        
		        // Verificar si est√°n colisionando
		        const isColliding = (
		            itemRect.bottom >= catcherRect.top &&
		            itemRect.top <= catcherRect.bottom &&
		            itemRect.right >= catcherRect.left &&
		            itemRect.left <= catcherRect.right
		        );
		        
		        if (isColliding) {
		            hasCollided = true;
		            handleItemCatch(item);
		            cancelAnimationFrame(animationFrameId);
		            return;
		        }
		        
		        // Continuar verificando en el siguiente frame
		        animationFrameId = requestAnimationFrame(checkCollision);
		    };
		    
		    animationFrameId = requestAnimationFrame(checkCollision);
		    
		    // Limpiar despu√©s de que el item caiga
		    setTimeout(() => {
		        if (item.parentElement) item.remove();
		        cancelAnimationFrame(animationFrameId);
		    }, duration * 1000 + 1000);
		}

		// Funci√≥n separada para manejar lo que pasa cuando atrapas algo
		function handleItemCatch(item) {
		    if (item.dataset.type === 'star') {
		        catchScore += 10 * catchMultiplier;
		        document.getElementById('catchScore').textContent = catchScore;
		        item.style.transition = 'transform 0.2s ease-out, opacity 0.2s ease-out';
		        item.style.transform = 'scale(2)';
		        item.style.opacity = '0';
		    } else if (item.dataset.type === 'powerup') {
		        applyPowerup(item.dataset.powerup);
		        item.style.transition = 'transform 0.3s ease-out, opacity 0.3s ease-out';
		        item.style.transform = 'scale(2) rotate(360deg)';
		        item.style.opacity = '0';
		    } else if (item.dataset.type === 'bomb') {
		        if (!hasShield) {
		            catchScore = Math.max(0, catchScore - 30);
		            document.getElementById('catchScore').textContent = catchScore;
		            
		            const catcher = document.getElementById('catcher');
		            catcher.style.animation = 'shake 0.3s ease-in-out';
		            setTimeout(() => catcher.style.animation = '', 300);
		        } else {
		            hasShield = false;
		            document.getElementById('catcher').style.filter = 'drop-shadow(0 0 10px rgba(255, 190, 11, 0.8))';
		        }
		    }
		    
		    setTimeout(() => {
		        if (item.parentElement) item.remove();
		    }, 300);
		}

		function applyPowerup(powerup) {
			switch(powerup) {
			case '‚ö°':
				catcherSpeed = 1.5;
				setTimeout(() => catcherSpeed = 1, 5000);
				break;
			case 'üåü':
				catchMultiplier = 2;
				document.getElementById('catchMultiplier').textContent = 'x' + catchMultiplier;
				setTimeout(() => {
					catchMultiplier = 1;
					document.getElementById('catchMultiplier').textContent = 'x' + catchMultiplier;
				}, 5000);
				break;
			case '‚è∞':
				catchTime += 10;
				document.getElementById('catchTime').textContent = catchTime;
				break;
			case 'üõ°Ô∏è':
				hasShield = true;
				document.getElementById('catcher').style.filter = 'drop-shadow(0 0 20px rgba(0, 255, 249, 1))';
				break;
			}
		}

		async function showGameOverAlert() {
			document.getElementById('finalScore').textContent = catchScore;
			document.getElementById('gameOverAlert').classList.add('active');
			await saveScore('catch', catchScore);
		}

		function closeGameOverAlert() {
			document.getElementById('gameOverAlert').classList.remove('active');
		}

		let catcherX = 0;
		document.getElementById('catchGameArea').addEventListener('mousemove', (e) => {
			if (!catchGameActive) return;
			const game = document.getElementById('catchGameArea');
			const catcher = document.getElementById('catcher');
			const rect = game.getBoundingClientRect();
			catcherX = e.clientX - rect.left - 40;
			catcherX = Math.max(0, Math.min(catcherX, game.offsetWidth - 80));
			catcher.style.left = catcherX + 'px';
		});

		// Touch support for mobile
		document.getElementById('catchGameArea').addEventListener('touchmove', (e) => {
			if (!catchGameActive) return;
			e.preventDefault();
			const game = document.getElementById('catchGameArea');
			const catcher = document.getElementById('catcher');
			const rect = game.getBoundingClientRect();
			const touch = e.touches[0];
			catcherX = touch.clientX - rect.left - 40;
			catcherX = Math.max(0, Math.min(catcherX, game.offsetWidth - 80));
			catcher.style.left = catcherX + 'px';
		});

		// ===== MEMORY GAME =====
		const emojis = ['üéÆ', 'üïπÔ∏è', 'üëæ', 'üéØ', 'üé≤', 'üÉè', 'üé∞', 'üèÜ'];
		let memoryCards = [];
		let flippedCards = [];
		let moves = 0;
		let pairs = 0;
		let memoryGameActive = false;
		let memoryStartTime = 0;
		let memoryTimer;

		function initMemoryGame() {
			if (!currentUser) return;
			
			const gameContainer = document.getElementById('memoryGrid');
			gameContainer.innerHTML = '';
			memoryCards = [...emojis, ...emojis].sort(() => Math.random() - 0.5);
			flippedCards = [];
			moves = 0;
			pairs = 0;
			memoryGameActive = true;
			memoryStartTime = Date.now();
			
			document.getElementById('memoryMoves').textContent = moves;
			document.getElementById('memoryPairs').textContent = `${pairs}/8`;

			memoryCards.forEach((emoji, index) => {
				const card = document.createElement('div');
				card.className = 'memory-card';
				card.dataset.emoji = emoji;
				card.dataset.index = index;
				card.addEventListener('click', flipCard);
				gameContainer.appendChild(card);
			});
		}

		let isProcessingFlip = false;

		function flipCard() {
		    if (!memoryGameActive || isProcessingFlip) return;
		    if (flippedCards.length === 2 || this.classList.contains('flipped') || this.classList.contains('matched')) {
		        return;
		    }
		    
		    this.textContent = this.dataset.emoji;
		    this.classList.add('flipped');
		    flippedCards.push(this);
		    
		    if (flippedCards.length === 2) {
		        isProcessingFlip = true; // ‚úÖ Bloquear clicks mientras se procesan las cartas
		        moves++;
		        document.getElementById('memoryMoves').textContent = moves;
		        
		        setTimeout(async () => {
		            if (flippedCards[0].dataset.emoji === flippedCards[1].dataset.emoji) {
		                flippedCards[0].classList.add('matched');
		                flippedCards[1].classList.add('matched');
		                pairs++;
		                document.getElementById('memoryPairs').textContent = `${pairs}/8`;
		                
		                if (pairs === 8) {
		                    memoryGameActive = false;
		                    setTimeout(async () => {
		                        document.getElementById('finalMoves').textContent = moves;
		                        document.getElementById('memoryVictoryAlert').classList.add('active');
		                        await saveScore('memory', moves);
		                    }, 300);
		                }
		            } else {
		                flippedCards[0].textContent = '';
		                flippedCards[1].textContent = '';
		                flippedCards[0].classList.remove('flipped');
		                flippedCards[1].classList.remove('flipped');
		            }
		            flippedCards = [];
		            isProcessingFlip = false; // ‚úÖ Desbloquear clicks
		        }, 800);
		    }
		}

		// Add shake and fall animations
		const style = document.createElement('style');
		style.textContent = `
			@keyframes shake {
				0%, 100% { transform: translateX(0); }
				25% { transform: translateX(-10px); }
				75% { transform: translateX(10px); }
			}
			@keyframes fall {
				to { transform: translateY(550px); }
			}
		`;
		document.head.appendChild(style);

// ===== NEON RUNNER GAME =====
let runnerGameActive = false;
let runnerScore = 0;
let runnerSpeed = 1;
let runnerObstacles = [];
let runnerInterval;
let runnerScoreInterval;
let isJumping = false;
let jumpHeight = 0;
let jumpVelocity = 0;
let gravity = 0.8;
let jumpPower = -15;

function startRunnerGame() {
    if (runnerGameActive || !currentUser) return;
    
    document.getElementById('runnerGameOverAlert').classList.remove('active');
    
    runnerGameActive = true;
    runnerScore = 0;
    runnerSpeed = 1;
    runnerObstacles = [];
    isJumping = false;
    jumpHeight = 0;
    jumpVelocity = 0;
    
    document.getElementById('runnerScore').textContent = runnerScore;
    document.getElementById('runnerSpeed').textContent = runnerSpeed.toFixed(1) + 'x';
    document.getElementById('runnerStartBtn').disabled = true;
    
    // Reset player position
    const player = document.getElementById('runnerPlayer');
    player.style.transform = 'scaleX(-1)'; // ‚úÖ Solo voltear
    player.style.transition = 'none'; // ‚úÖ Sin transition
    
    // Limpiar obst√°culos anteriores
    document.querySelectorAll('.runner-obstacle').forEach(obs => obs.remove());
    
    // Crear obst√°culos m√°s espaciados
    runnerInterval = setInterval(() => {
        if (!runnerGameActive) return;
        createObstacle();
    }, 2500);
    
    // Incrementar score m√°s lento
    runnerScoreInterval = setInterval(() => {
        if (!runnerGameActive) return;
        runnerScore += 1;
        document.getElementById('runnerScore').textContent = runnerScore;
        
        // Aumentar velocidad m√°s gradualmente
        if (runnerScore % 200 === 0 && runnerSpeed < 2) {
            runnerSpeed += 0.05;
            document.getElementById('runnerSpeed').textContent = runnerSpeed.toFixed(1) + 'x';
            
            // Reducir tiempo entre obst√°culos gradualmente
            clearInterval(runnerInterval);
            const newInterval = Math.max(1800, 2500 - (runnerScore / 4));
            runnerInterval = setInterval(() => {
                if (!runnerGameActive) return;
                createObstacle();
            }, newInterval);
        }
    }, 100);
    
    // Sistema de f√≠sica de salto
    const jumpPhysics = setInterval(() => {
        if (!runnerGameActive) {
            clearInterval(jumpPhysics);
            return;
        }
        
        const player = document.getElementById('runnerPlayer');
        
        if (isJumping) {
            jumpVelocity += gravity;
            jumpHeight += jumpVelocity;
            
            // Aterrizar
            if (jumpHeight >= 0) {
                jumpHeight = 0;
                jumpVelocity = 0;
                isJumping = false;
                player.classList.remove('jumping');
            }
            
            // ‚úÖ Mantener scaleX(-1) SIEMPRE
            player.style.transform = `scaleX(-1) translate(0, ${jumpHeight}px)`;
        } else {
            // ‚úÖ Cuando no est√° saltando, solo voltear
            player.style.transform = 'scaleX(-1)';
        }
    }, 16);
}

function stopRunnerGame() {
    runnerGameActive = false;
    clearInterval(runnerInterval);
    clearInterval(runnerScoreInterval);
    
    document.querySelectorAll('.runner-obstacle').forEach(obs => obs.remove());
    document.getElementById('runnerStartBtn').disabled = false;
    
    // Reset player
    const player = document.getElementById('runnerPlayer');
    player.style.transform = 'scaleX(-1)';

    isJumping = false;
    jumpHeight = 0;
    jumpVelocity = 0;
}

function createObstacle() {
    if (!runnerGameActive) return;
    
    const obstacle = document.createElement('div');
    obstacle.className = 'runner-obstacle';
    
    const obstacles = ['üåµ', 'üß±', 'üöß', 'üî•'];
    obstacle.textContent = obstacles[Math.floor(Math.random() * obstacles.length)];
    
    const gameArea = document.getElementById('runnerGameArea');
    obstacle.style.insetInlineStart = gameArea.offsetWidth + 'px';
    
    // Velocidad m√°s controlada
    const baseDuration = 2.5; // Cambiado de 3 a 2.5
    const duration = baseDuration / runnerSpeed;
    obstacle.style.animationDuration = duration + 's';
    
    gameArea.appendChild(obstacle);
    runnerObstacles.push(obstacle);
    
    // Verificar colisiones con hitbox m√°s preciso
    let collisionCheckInterval = setInterval(() => {
        if (!runnerGameActive || !obstacle.parentElement) {
            clearInterval(collisionCheckInterval);
            return;
        }
        
        const playerRect = document.getElementById('runnerPlayer').getBoundingClientRect();
        const obstacleRect = obstacle.getBoundingClientRect();
        
        // Hitbox m√°s peque√±o y preciso
        const playerHitbox = {
            left: playerRect.left + 8,
            right: playerRect.right - 8,
            top: playerRect.top + 8,
            bottom: playerRect.bottom - 5
        };
        
        const obstacleHitbox = {
            left: obstacleRect.left + 5,
            right: obstacleRect.right - 5,
            top: obstacleRect.top + 5,
            bottom: obstacleRect.bottom - 2
        };
        
        const isColliding = (
            playerHitbox.right > obstacleHitbox.left &&
            playerHitbox.left < obstacleHitbox.right &&
            playerHitbox.bottom > obstacleHitbox.top &&
            playerHitbox.top < obstacleHitbox.bottom
        );
        
        if (isColliding) {
            clearInterval(collisionCheckInterval);
            stopRunnerGame();
            showRunnerGameOver();
        }
    }, 16); // M√°s frecuente para mejor precisi√≥n
    
    // Remover obst√°culo despu√©s de que salga de pantalla
    setTimeout(() => {
        if (obstacle.parentElement) {
            obstacle.remove();
            runnerObstacles = runnerObstacles.filter(obs => obs !== obstacle);
        }
        clearInterval(collisionCheckInterval);
    }, duration * 1000 + 500);
}

function jump() {
    if (!runnerGameActive || isJumping) return;
    
    isJumping = true;
    jumpVelocity = jumpPower;
    const player = document.getElementById('runnerPlayer');
    player.classList.add('jumping');
}

// Controles de salto
document.addEventListener('keydown', (e) => {
    if (e.code === 'Space' && runnerGameActive) {
        e.preventDefault();
        jump();
    }
});

document.getElementById('runnerGameArea').addEventListener('click', () => {
    if (runnerGameActive) jump();
});

document.getElementById('runnerGameArea').addEventListener('touchstart', (e) => {
    if (runnerGameActive) {
        e.preventDefault();
        jump();
    }
});

async function showRunnerGameOver() {
    document.getElementById('runnerFinalScore').textContent = runnerScore;
    document.getElementById('runnerGameOverAlert').classList.add('active');
    await saveScore('runner', runnerScore);
}

function closeRunnerGameOver() {
    document.getElementById('runnerGameOverAlert').classList.remove('active');
}

		// Cargar stats de Runner
		async function loadRunnerStats() {
		    if (!currentUser || !currentUser.uid || !isStorageAvailable()) return;
		    
		    try {
		        const docId = currentUser.uid;
		        const runnerDoc = await db.collection('user_best_runner').doc(docId).get();
		        if (runnerDoc.exists) {
		            document.getElementById('runnerBestPreview').textContent = runnerDoc.data().score;
		        }
		    } catch (error) {
		        console.error('Error loading runner stats:', error);
		    }
		}

async function loadRunnerLeaderboard() {
    if (!isStorageAvailable()) return;
    
    const leaderboardEl = document.getElementById('runnerLeaderboard');
    if (!leaderboardEl) return; // Si no existe el elemento, salir
    
    leaderboardEl.innerHTML = '<li class="no-scores">Loading...</li>';

    try {
        const snapshot = await db.collection('user_best_runner')
            .orderBy('score', 'desc')
            .limit(10)
            .get();

        if (snapshot.empty) {
            leaderboardEl.innerHTML = '<li class="no-scores">No scores yet. Be the first!</li>';
            document.getElementById('runnerWorldPreview').textContent = '-';
            return;
        }

        const sortedScores = snapshot.docs.map(doc => doc.data());
        document.getElementById('runnerWorldPreview').textContent = sortedScores[0].score;

        leaderboardEl.innerHTML = sortedScores.map((score, index) => {
            const rankClass = index === 0 ? 'top-1' : index === 1 ? 'top-2' : index === 2 ? 'top-3' : '';
            const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}.`;
            return `
                <li class="leaderboard-item ${rankClass}">
                    <span class="leaderboard-rank">${medal}</span>
                    <span class="leaderboard-name">${score.username}</span>
                    <span class="leaderboard-score">${score.score}</span>
                </li>
            `;
        }).join('');
    } catch (error) {
        console.error('Error loading runner leaderboard:', error);
        leaderboardEl.innerHTML = '<li class="no-scores">Error loading scores</li>';
    }
}

		// ===== SPACE INVADERS GAME =====
// ===== SPACE INVADERS GAME =====
let invadersGameActive = false;
let invadersScore = 0;
let invadersLives = 3;
let invadersWave = 1;
let invadersList = [];
let bulletsList = [];
let enemyBulletsList = [];
let invadersPlayerX = 0;
let invadersGameLoop;
let invadersShootInterval;
let lastShotTime = 0;
const shootCooldown = 300;
const maxBullets = 3; // L√≠mite de balas en pantalla
const maxEnemyBullets = 5; // L√≠mite de balas enemigas

function startInvadersGame() {
    if (invadersGameActive || !currentUser) return;
    
    document.getElementById('invadersGameOverAlert').classList.remove('active');
    
    invadersGameActive = true;
    invadersScore = 0;
    invadersLives = 3;
    invadersWave = 1;
    invadersList = [];
    bulletsList = [];
    enemyBulletsList = [];
    
    document.getElementById('invadersScore').textContent = invadersScore;
    document.getElementById('invadersLives').textContent = '‚ù§Ô∏è'.repeat(invadersLives);
    document.getElementById('invadersWave').textContent = invadersWave;
    document.getElementById('invadersStartBtn').disabled = true;
    
    // Limpiar elementos anteriores
    document.querySelectorAll('.invader, .bullet, .enemy-bullet, .explosion').forEach(el => el.remove());
    
    // Posicionar jugador
    const gameArea = document.getElementById('invadersGameArea');
    const player = document.getElementById('invadersPlayer');
    invadersPlayerX = (gameArea.offsetWidth - player.offsetWidth) / 2;
    player.style.left = invadersPlayerX + 'px';
    
    createInvaderWave();
    
    invadersGameLoop = setInterval(updateInvadersGame, 1000 / 60);
    invadersShootInterval = setInterval(enemyShoot, 2000); // Aumentado de 1500 a 2000
}

function stopInvadersGame() {
    invadersGameActive = false;
    clearInterval(invadersGameLoop);
    clearInterval(invadersShootInterval);
    
    document.querySelectorAll('.invader, .bullet, .enemy-bullet, .explosion').forEach(el => el.remove());
    document.getElementById('invadersStartBtn').disabled = false;
}

function createInvaderWave() {
    const gameArea = document.getElementById('invadersGameArea');
    
    // Reducir n√∫mero de invasores para evitar lag
    const maxRows = Math.min(4, 3 + Math.floor(invadersWave / 4)); // M√°ximo 4 filas
    const maxCols = Math.min(7, 5 + Math.floor(invadersWave / 3)); // M√°ximo 7 columnas
    
    const rows = maxRows;
    const cols = maxCols;
    const spacing = Math.min(60, gameArea.offsetWidth / (cols + 1));
    
    for (let row = 0; row < rows; row++) {
        for (let col = 0; col < cols; col++) {
            const invader = document.createElement('div');
            invader.className = 'invader';
            invader.textContent = ['üëæ', 'üëΩ', 'üõ∏'][row % 3];
            
            const x = col * spacing + 30;
            const y = row * 50 + 30;
            
            invader.style.left = x + 'px';
            invader.style.top = y + 'px';
            invader.dataset.x = x;
            invader.dataset.y = y;
            invader.dataset.direction = 1;
            
            gameArea.appendChild(invader);
            invadersList.push(invader);
        }
    }
}

function updateInvadersGame() {
    if (!invadersGameActive) return;
    
    // Mover invasores (optimizado)
    let shouldMoveDown = false;
    const gameArea = document.getElementById('invadersGameArea');
    const maxWidth = gameArea.offsetWidth;
    const moveSpeed = 0.3 * (1 + invadersWave * 0.05); // Reducido para menos lag
    
    // Usar requestAnimationFrame para mejor rendimiento
    invadersList.forEach(invader => {
        if (!invader.parentElement) return;
        
        let x = parseFloat(invader.dataset.x);
        const y = parseFloat(invader.dataset.y);
        const direction = parseFloat(invader.dataset.direction);
        
        x += direction * moveSpeed;
        
        if (x <= 0 || x >= maxWidth - 50) {
            shouldMoveDown = true;
        }
        
        invader.dataset.x = x;
        invader.style.left = x + 'px';
    });
    
    if (shouldMoveDown) {
        invadersList.forEach(invader => {
            if (!invader.parentElement) return;
            
            let y = parseFloat(invader.dataset.y);
            y += 15; // Reducido de 20 a 15
            invader.dataset.y = y;
            invader.style.top = y + 'px';
            invader.dataset.direction *= -1;
            
            // Game over si llegan abajo
            if (y > gameArea.offsetHeight - 100) {
                loseLife();
            }
        });
    }
    
    // Mover balas del jugador (optimizado)
    for (let i = bulletsList.length - 1; i >= 0; i--) {
        const bullet = bulletsList[i];
        
        if (!bullet || !bullet.parentElement) {
            bulletsList.splice(i, 1);
            continue;
        }
        
        let y = parseFloat(bullet.style.top);
        y -= 8;
        bullet.style.top = y + 'px';
        
        // Remover si sale de pantalla
        if (y < -20) {
            bullet.remove();
            bulletsList.splice(i, 1);
            continue;
        }
        
        // Verificar colisi√≥n con invasores (optimizado)
        const bulletRect = bullet.getBoundingClientRect();
        let hitDetected = false;
        
        for (let j = invadersList.length - 1; j >= 0; j--) {
            const invader = invadersList[j];
            if (!invader || !invader.parentElement) {
                invadersList.splice(j, 1);
                continue;
            }
            
            const invaderRect = invader.getBoundingClientRect();
            if (checkCollision(bulletRect, invaderRect)) {
                createExplosion(invaderRect.left, invaderRect.top);
                invader.remove();
                invadersList.splice(j, 1);
                bullet.remove();
                bulletsList.splice(i, 1);
                
                invadersScore += 10 * invadersWave;
                document.getElementById('invadersScore').textContent = invadersScore;
                
                hitDetected = true;
                
                // Nueva oleada si eliminamos todos
                if (invadersList.length === 0) {
                    invadersWave++;
                    document.getElementById('invadersWave').textContent = invadersWave;
                    setTimeout(() => {
                        if (invadersGameActive) createInvaderWave();
                    }, 1000);
                }
                break;
            }
        }
        
        if (hitDetected) break;
    }
    
    // Mover balas enemigas (optimizado)
    for (let i = enemyBulletsList.length - 1; i >= 0; i--) {
        const bullet = enemyBulletsList[i];
        
        if (!bullet || !bullet.parentElement) {
            enemyBulletsList.splice(i, 1);
            continue;
        }
        
        let y = parseFloat(bullet.style.top);
        y += 4;
        bullet.style.top = y + 'px';
        
        // Remover si sale de pantalla
        if (y > gameArea.offsetHeight + 20) {
            bullet.remove();
            enemyBulletsList.splice(i, 1);
            continue;
        }
        
        // Verificar colisi√≥n con jugador
        const bulletRect = bullet.getBoundingClientRect();
        const playerRect = document.getElementById('invadersPlayer').getBoundingClientRect();
        
        if (checkCollision(bulletRect, playerRect)) {
            bullet.remove();
            enemyBulletsList.splice(i, 1);
            loseLife();
        }
    }
}

function checkCollision(rect1, rect2) {
    return (
        rect1.left < rect2.right &&
        rect1.right > rect2.left &&
        rect1.top < rect2.bottom &&
        rect1.bottom > rect2.top
    );
}

function shootBullet() {
    if (!invadersGameActive) return;
    
    const now = Date.now();
    if (now - lastShotTime < shootCooldown) return;
    
    // L√≠mite de balas en pantalla
    if (bulletsList.length >= maxBullets) return;
    
    lastShotTime = now;
    
    const player = document.getElementById('invadersPlayer');
    const bullet = document.createElement('div');
    bullet.className = 'bullet';
    
    const playerRect = player.getBoundingClientRect();
    const gameAreaRect = document.getElementById('invadersGameArea').getBoundingClientRect();
    
    bullet.style.left = (playerRect.left - gameAreaRect.left + playerRect.width / 2 - 2) + 'px';
    bullet.style.top = (playerRect.top - gameAreaRect.top) + 'px';
    
    document.getElementById('invadersGameArea').appendChild(bullet);
    bulletsList.push(bullet);
}

function enemyShoot() {
    if (!invadersGameActive || invadersList.length === 0) return;
    
    // L√≠mite de balas enemigas
    if (enemyBulletsList.length >= maxEnemyBullets) return;
    
    // Seleccionar un invasor aleatorio de los que est√°n m√°s abajo
    const bottomInvaders = invadersList.filter(inv => {
        if (!inv || !inv.parentElement) return false;
        const y = parseFloat(inv.dataset.y);
        return y > 100; // Solo los que est√°n m√°s abajo pueden disparar
    });
    
    if (bottomInvaders.length === 0) return;
    
    const shooter = bottomInvaders[Math.floor(Math.random() * bottomInvaders.length)];
    if (!shooter || !shooter.parentElement) return;
    
    const bullet = document.createElement('div');
    bullet.className = 'bullet enemy-bullet';
    
    const shooterRect = shooter.getBoundingClientRect();
    const gameAreaRect = document.getElementById('invadersGameArea').getBoundingClientRect();
    
    bullet.style.left = (shooterRect.left - gameAreaRect.left + shooterRect.width / 2 - 2) + 'px';
    bullet.style.top = (shooterRect.bottom - gameAreaRect.top) + 'px';
    
    document.getElementById('invadersGameArea').appendChild(bullet);
    enemyBulletsList.push(bullet);
}

function createExplosion(x, y) {
    const explosion = document.createElement('div');
    explosion.className = 'explosion';
    explosion.textContent = 'üí•';
    explosion.style.left = x + 'px';
    explosion.style.top = y + 'px';
    explosion.style.position = 'fixed'; // Cambiar a fixed para evitar bugs
    
    document.body.appendChild(explosion); // Agregar al body en vez del gameArea
    
    setTimeout(() => {
        if (explosion.parentElement) explosion.remove();
    }, 500);
}

function loseLife() {
    invadersLives--;
    document.getElementById('invadersLives').textContent = '‚ù§Ô∏è'.repeat(Math.max(0, invadersLives));
    
    if (invadersLives <= 0) {
        stopInvadersGame();
        showInvadersGameOver();
    } else {
        // Flash del jugador
        const player = document.getElementById('invadersPlayer');
        player.style.animation = 'shake 0.3s ease-in-out';
        setTimeout(() => player.style.animation = '', 300);
    }
}

async function showInvadersGameOver() {
    document.getElementById('invadersFinalScore').textContent = invadersScore;
    document.getElementById('invadersFinalWave').textContent = invadersWave;
    document.getElementById('invadersGameOverAlert').classList.add('active');
    await saveScore('invaders', invadersScore);
}

function closeInvadersGameOver() {
    document.getElementById('invadersGameOverAlert').classList.remove('active');
}

// Controles de movimiento
let keysPressed = {};

document.addEventListener('keydown', (e) => {
    if (!invadersGameActive) return;
    keysPressed[e.key] = true;
    
    if (e.code === 'Space') {
        e.preventDefault();
        shootBullet();
    }
});

document.addEventListener('keyup', (e) => {
    keysPressed[e.key] = false;
});

// Actualizar posici√≥n del jugador basado en teclas
setInterval(() => {
    if (!invadersGameActive) return;
    
    const gameArea = document.getElementById('invadersGameArea');
    const player = document.getElementById('invadersPlayer');
    const speed = 5;
    
    if (keysPressed['ArrowLeft'] || keysPressed['a'] || keysPressed['A']) {
        invadersPlayerX = Math.max(0, invadersPlayerX - speed);
    }
    if (keysPressed['ArrowRight'] || keysPressed['d'] || keysPressed['D']) {
        invadersPlayerX = Math.min(gameArea.offsetWidth - player.offsetWidth, invadersPlayerX + speed);
    }
    
    player.style.left = invadersPlayerX + 'px';
}, 16);

// Control con mouse/touch
document.getElementById('invadersGameArea').addEventListener('mousemove', (e) => {
    if (!invadersGameActive) return;
    
    const gameArea = document.getElementById('invadersGameArea');
    const player = document.getElementById('invadersPlayer');
    const rect = gameArea.getBoundingClientRect();
    
    invadersPlayerX = e.clientX - rect.left - player.offsetWidth / 2;
    invadersPlayerX = Math.max(0, Math.min(invadersPlayerX, gameArea.offsetWidth - player.offsetWidth));
    player.style.left = invadersPlayerX + 'px';
});

document.getElementById('invadersGameArea').addEventListener('click', (e) => {
    if (invadersGameActive) {
        e.preventDefault();
        shootBullet();
    }
});

document.getElementById('invadersGameArea').addEventListener('touchmove', (e) => {
    if (!invadersGameActive) return;
    e.preventDefault();
    
    const gameArea = document.getElementById('invadersGameArea');
    const player = document.getElementById('invadersPlayer');
    const rect = gameArea.getBoundingClientRect();
    const touch = e.touches[0];
    
    invadersPlayerX = touch.clientX - rect.left - player.offsetWidth / 2;
    invadersPlayerX = Math.max(0, Math.min(invadersPlayerX, gameArea.offsetWidth - player.offsetWidth));
    player.style.left = invadersPlayerX + 'px';
});

document.getElementById('invadersGameArea').addEventListener('touchstart', (e) => {
    if (invadersGameActive) {
        e.preventDefault();
        shootBullet();
    }
});

// Cargar stats de Invaders
async function loadInvadersStats() {
    if (!currentUser || !currentUser.uid || !isStorageAvailable()) return;
    
    try {
        const docId = currentUser.uid;
        const invadersDoc = await db.collection('user_best_invaders').doc(docId).get();
        if (invadersDoc.exists) {
            document.getElementById('invadersBestPreview').textContent = invadersDoc.data().score;
        }
    } catch (error) {
        console.error('Error loading invaders stats:', error);
    }
}

async function loadInvadersLeaderboard() {
    if (!isStorageAvailable()) return;

    const leaderboardEl = document.getElementById('invadersLeaderboard');
    if (!leaderboardEl) return;
    
    leaderboardEl.innerHTML = '<li class="no-scores">Loading...</li>';

    try {
        const snapshot = await db.collection('user_best_invaders')
            .orderBy('score', 'desc')
            .limit(10)
            .get();

        if (snapshot.empty) {
            leaderboardEl.innerHTML = '<li class="no-scores">No scores yet. Be the first!</li>';
            document.getElementById('invadersWorldPreview').textContent = '-';
            return;
        }

        const sortedScores = snapshot.docs.map(doc => doc.data());
        document.getElementById('invadersWorldPreview').textContent = sortedScores[0].score;

        leaderboardEl.innerHTML = sortedScores.map((score, index) => {
            const rankClass = index === 0 ? 'top-1' : index === 1 ? 'top-2' : index === 2 ? 'top-3' : '';
            const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}.`;
            return `
                <li class="leaderboard-item ${rankClass}">
                    <span class="leaderboard-rank">${medal}</span>
                    <span class="leaderboard-name">${score.username}</span>
                    <span class="leaderboard-score">${score.score}</span>
                </li>
            `;
        }).join('');
    } catch (error) {
        console.error('Error loading invaders leaderboard:', error);
        leaderboardEl.innerHTML = '<li class="no-scores">Error loading scores</li>';
    }
}

		// Load leaderboards on page load
		window.addEventListener('load', async () => {
			// Esperar a que storage est√© disponible
			let attempts = 0;
			const checkStorage = setInterval(async () => {
				attempts++;
				if (isStorageAvailable()) {
					clearInterval(checkStorage);
					await loadLeaderboards();
				} else if (attempts > 20) {
					clearInterval(checkStorage);
					console.log('Storage not available after 2 seconds');
					document.getElementById('catchLeaderboard').innerHTML = '<li class="no-scores">Storage not available</li>';
					document.getElementById('memoryLeaderboard').innerHTML = '<li class="no-scores">Storage not available</li>';
				}
			}, 100);
		});
	</script>
</body>
</html>
